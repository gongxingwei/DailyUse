# Goal æ¨¡å— - é¢†åŸŸæ¨¡å‹è§„åˆ’æ–‡æ¡£

> **åˆ›å»ºæ—¶é—´**: 2025-01-20  
> **æ›´æ–°æ—¶é—´**: 2025-01-13  
> **æ–‡æ¡£ç‰ˆæœ¬**: v1.1  
> **å‚è€ƒæ¨¡å¼**: Repository æ¨¡å—çš„ DDD æ¶æ„  
> **ä¿®æ­£å†…å®¹**: DTO å‘½åè§„èŒƒã€å®Œæ•´ DTO è½¬æ¢æ–¹æ³•ã€PersistenceDTO å®šä¹‰ã€é€»è¾‘åˆ é™¤

---

## ğŸ“‹ ç›®å½•

1. [é¢†åŸŸèŒƒå›´](#1-é¢†åŸŸèŒƒå›´)
2. [æ ¸å¿ƒä¸šåŠ¡éœ€æ±‚](#2-æ ¸å¿ƒä¸šåŠ¡éœ€æ±‚)
3. [èšåˆæ ¹è®¾è®¡](#3-èšåˆæ ¹è®¾è®¡)
4. [å®ä½“è®¾è®¡](#4-å®ä½“è®¾è®¡)
5. [å€¼å¯¹è±¡è®¾è®¡](#5-å€¼å¯¹è±¡è®¾è®¡)
6. [ä»“å‚¨æ¥å£è®¾è®¡](#6-ä»“å‚¨æ¥å£è®¾è®¡)
7. [é¢†åŸŸæœåŠ¡è®¾è®¡](#7-é¢†åŸŸæœåŠ¡è®¾è®¡)
8. [åº”ç”¨å±‚ä¸šåŠ¡](#8-åº”ç”¨å±‚ä¸šåŠ¡)
9. [TypeScript ç±»å‹å®šä¹‰](#9-typescript-ç±»å‹å®šä¹‰)

---

## 1. é¢†åŸŸèŒƒå›´

### é¢†åŸŸè¾¹ç•Œ

**Goal æ¨¡å—** è´Ÿè´£ç›®æ ‡ç®¡ç†çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œé‡‡ç”¨ **OKR (Objectives and Key Results)** æ¨¡å¼è¿›è¡Œç›®æ ‡ç®¡ç†ã€‚

**æ ¸å¿ƒæ¦‚å¿µ**:

- **Objective (ç›®æ ‡)**: æ˜ç¡®çš„ã€å¯è¡¡é‡çš„ç›®æ ‡é™ˆè¿°
- **Key Result (å…³é”®ç»“æœ)**: ç”¨äºè¡¡é‡ç›®æ ‡è¾¾æˆåº¦çš„å…·ä½“æŒ‡æ ‡
- **Goal Folder (ç›®æ ‡æ–‡ä»¶å¤¹)**: å±‚çº§åŒ–çš„ç›®æ ‡ç»„ç»‡ç»“æ„
- **Goal Statistics (ç›®æ ‡ç»Ÿè®¡)**: ç›®æ ‡æ•°æ®çš„èšåˆç»Ÿè®¡

**é¢†åŸŸè¾¹ç•Œ**:

- âœ… ç›®æ ‡çš„åˆ›å»ºã€æ›´æ–°ã€å½’æ¡£ã€åˆ é™¤
- âœ… å…³é”®ç»“æœçš„å®šä¹‰ã€è¿›åº¦è¿½è¸ªã€å®Œæˆåˆ¤å®š
- âœ… ç›®æ ‡æ–‡ä»¶å¤¹çš„å±‚çº§ç®¡ç†
- âœ… ç›®æ ‡çš„å…ƒæ•°æ®ï¼ˆæ ‡ç­¾ã€é‡è¦æ€§ã€ç´§æ€¥æ€§ï¼‰
- âœ… ç›®æ ‡çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼ˆè‰ç¨¿ã€è¿›è¡Œä¸­ã€å·²å®Œæˆã€å·²å½’æ¡£ã€å·²åˆ é™¤ï¼‰
- âœ… ç›®æ ‡æé†’ï¼ˆå‰©ä½™å¤©æ•°æé†’ï¼‰
- âœ… ç›®æ ‡ç»Ÿè®¡å’Œæ•°æ®èšåˆ
- âŒ ä»»åŠ¡çš„å…·ä½“æ‰§è¡Œï¼ˆå±äº Task æ¨¡å—ï¼‰
- âŒ æé†’çš„è°ƒåº¦æ‰§è¡Œï¼ˆå±äº Schedule æ¨¡å—ï¼‰

---

## 2. æ ¸å¿ƒä¸šåŠ¡éœ€æ±‚

### 2.1 OKR å¼ç›®æ ‡ç®¡ç†

- æ¯ä¸ªç›®æ ‡åŒ…å« 1-5 ä¸ªå…³é”®ç»“æœ
- å…³é”®ç»“æœæœ‰æ˜ç¡®çš„ç›®æ ‡å€¼å’Œå½“å‰è¿›åº¦
- å…³é”®ç»“æœæœ‰ç»“æŸæ—¶é—´ï¼ˆå¯é€‰ï¼‰
- æ”¯æŒè‡ªåŠ¨è®¡ç®—ç›®æ ‡å®Œæˆåº¦ï¼ˆåŸºäºå…³é”®ç»“æœï¼‰

### 2.2 æ–‡ä»¶å¤¹å±‚çº§ç®¡ç†

**ç³»ç»Ÿæ–‡ä»¶å¤¹**ï¼ˆä¸å¯åˆ é™¤ï¼‰:

- ğŸ“‚ å…¨éƒ¨ç›®æ ‡
- ğŸ“ å·²å½’æ¡£
- ğŸ—‘ï¸ å·²åˆ é™¤

**ç”¨æˆ·æ–‡ä»¶å¤¹**:

- æ”¯æŒå¤šå±‚çº§åµŒå¥—ï¼ˆå»ºè®® 3 å±‚ä»¥å†…ï¼‰
- æ”¯æŒæ‹–æ‹½æ’åº
- æ”¯æŒé‡å‘½åã€åˆ é™¤ï¼ˆä¼šç§»åŠ¨ç›®æ ‡åˆ°"å…¨éƒ¨ç›®æ ‡"ï¼‰

### 2.3 å¯æ‰©å±•å…ƒæ•°æ®

- **æ ‡ç­¾ç³»ç»Ÿ**: å¤šæ ‡ç­¾åˆ†ç±»
- **é‡è¦æ€§ç­‰çº§**: Vital > Important > Moderate > Minor > Trivial
- **ç´§æ€¥æ€§ç­‰çº§**: Critical > High > Medium > Low > None
- **è‡ªå®šä¹‰å­—æ®µ**: é¢„ç•™æ‰©å±•æ¥å£

### 2.4 å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

```
draft â†’ active â†’ completed â†’ archived
   â†“       â†“         â†“          â†“
   â””â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ deleted
```

**çŠ¶æ€è½¬æ¢è§„åˆ™**:

- `draft` â†’ `active`: å¼€å§‹æ‰§è¡Œç›®æ ‡
- `active` â†’ `completed`: æ‰€æœ‰å…³é”®ç»“æœè¾¾æˆ
- `active` â†’ `archived`: æ‰‹åŠ¨å½’æ¡£ï¼ˆæœªå®Œæˆä½†ä¸å†è¿½è¸ªï¼‰
- `completed` â†’ `archived`: å®Œæˆåå½’æ¡£
- ä»»ä½•çŠ¶æ€ â†’ `deleted`: è½¯åˆ é™¤ï¼ˆå¯æ¢å¤ï¼‰

### 2.5 æé†’è®¾ç½®

- æ”¯æŒå‰©ä½™å¤©æ•°æé†’ï¼ˆä¾‹å¦‚ï¼šè·ç¦»ç»“æŸ 7 å¤©ã€3 å¤©ã€1 å¤©ï¼‰
- æ”¯æŒè‡ªå®šä¹‰æé†’æ—¶é—´ç‚¹
- æé†’è§¦å‘åè°ƒç”¨ Reminder æ¨¡å—

### 2.6 æ•°æ®ç»Ÿè®¡

**ä¸ªäººç»Ÿè®¡**:

- è¿›è¡Œä¸­çš„ç›®æ ‡æ•°é‡
- å·²å®Œæˆç›®æ ‡æ•°é‡
- æ€»ä½“å®Œæˆç‡
- å„é‡è¦æ€§ç­‰çº§çš„ç›®æ ‡åˆ†å¸ƒ

**ç›®æ ‡ç»´åº¦ç»Ÿè®¡**:

- å…³é”®ç»“æœå®Œæˆè¿›åº¦
- é¢„è®¡å‰©ä½™æ—¶é—´
- ç›¸å…³ä»»åŠ¡æ•°é‡ï¼ˆè·¨æ¨¡å—æŸ¥è¯¢ï¼‰

---

## 3. èšåˆæ ¹è®¾è®¡

### 3.1 Goal èšåˆæ ¹

**èŒè´£**:

- ç®¡ç†ç›®æ ‡çš„åŸºæœ¬ä¿¡æ¯
- ç®¡ç†å…³é”®ç»“æœçš„é›†åˆ
- æ‰§è¡Œç›®æ ‡çš„ä¸šåŠ¡é€»è¾‘
- ç¡®ä¿å…³é”®ç»“æœçš„ä¸€è‡´æ€§
- ä½œä¸ºç›®æ ‡çš„äº‹åŠ¡è¾¹ç•Œ

**æ ¸å¿ƒå±æ€§**:

```typescript
export class Goal extends AggregateRoot implements IGoalServer {
  // ===== åŸºæœ¬ä¿¡æ¯ =====
  private _accountUuid: string; // æ‰€å±è´¦æˆ·
  private _title: string; // ç›®æ ‡æ ‡é¢˜ï¼ˆObjectiveï¼‰
  private _description: string | null; // è¯¦ç»†æè¿°

  // ===== æ—¶é—´ç®¡ç† =====
  private _startDate: Date | null; // å¼€å§‹æ—¥æœŸ
  private _endDate: Date | null; // ç»“æŸæ—¥æœŸï¼ˆå¯é€‰ï¼‰
  private _reminderDays: number[]; // æé†’å¤©æ•°ï¼ˆä¾‹å¦‚ [7, 3, 1]ï¼‰

  // ===== å…³é”®ç»“æœ =====
  private _keyResults: KeyResult[]; // å…³é”®ç»“æœé›†åˆï¼ˆå®ä½“ï¼‰

  // ===== å…ƒæ•°æ® =====
  private _importance: ImportanceLevel; // é‡è¦æ€§ç­‰çº§
  private _urgency: UrgencyLevel; // ç´§æ€¥æ€§ç­‰çº§
  private _tags: string[]; // æ ‡ç­¾
  private _customFields: Map<string, any>; // è‡ªå®šä¹‰å­—æ®µ

  // ===== ç»„ç»‡ç»“æ„ =====
  private _folderUuid: string | null; // æ‰€å±æ–‡ä»¶å¤¹

  // ===== ç”Ÿå‘½å‘¨æœŸ =====
  private _status: GoalStatus; // çŠ¶æ€
  private _createdAt: Date;
  private _updatedAt: Date;
  private _completedAt: Date | null;
  private _archivedAt: Date | null;
  private _deletedAt: Date | null;
}
```

**æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•**:

```typescript
export class Goal extends AggregateRoot {
  // ===== å·¥å‚æ–¹æ³• =====
  public static create(params: CreateGoalParams): Goal;

  // ===== å…³é”®ç»“æœç®¡ç† =====
  public addKeyResult(params: CreateKeyResultParams): KeyResult;
  public updateKeyResult(keyResultId: string, params: UpdateKeyResultParams): void;
  public removeKeyResult(keyResultId: string): void;
  public updateKeyResultProgress(keyResultId: string, currentValue: number): void;

  // ===== çŠ¶æ€è½¬æ¢ =====
  public activate(): void; // å¼€å§‹æ‰§è¡Œ
  public complete(): void; // å®Œæˆç›®æ ‡
  public archive(): void; // å½’æ¡£
  public softDelete(): void; // è½¯åˆ é™¤
  public restore(): void; // ä»å·²åˆ é™¤æ¢å¤

  // ===== å…ƒæ•°æ®æ›´æ–° =====
  public updateTitle(title: string): void;
  public updateDescription(description: string | null): void;
  public updateImportance(importance: ImportanceLevel): void;
  public updateUrgency(urgency: UrgencyLevel): void;
  public updateTags(tags: string[]): void;
  public moveToFolder(folderUuid: string | null): void;

  // ===== æ—¶é—´ç®¡ç† =====
  public updateDates(startDate: Date | null, endDate: Date | null): void;
  public updateReminderDays(reminderDays: number[]): void;

  // ===== è®¡ç®—å±æ€§ =====
  public getOverallProgress(): number; // åŸºäºå…³é”®ç»“æœè®¡ç®—æ€»è¿›åº¦
  public isOverdue(): boolean; // æ˜¯å¦å·²è¿‡æœŸ
  public getRemainingDays(): number | null; // å‰©ä½™å¤©æ•°
  public isCompleted(): boolean; // æ˜¯å¦æ‰€æœ‰å…³é”®ç»“æœéƒ½å®Œæˆ

  // ===== DTO è½¬æ¢æ–¹æ³•ï¼ˆDomain-Server å±‚ï¼‰=====
  public toServerDTO(includeChildren = false): GoalServerDTO;
  public toPersistenceDTO(): GoalPersistenceDTO;
  public static fromServerDTO(dto: GoalServerDTO): Goal;
  public static fromPersistenceDTO(dto: GoalPersistenceDTO): Goal;
}
```

**Domain-Client å±‚é¢å¤–æ–¹æ³•**:

```typescript
export class GoalClient extends AggregateRoot {
  // ... åŒ Domain-Server å±‚çš„ä¸šåŠ¡æ–¹æ³•

  // ===== DTO è½¬æ¢æ–¹æ³•ï¼ˆDomain-Client å±‚ï¼‰=====
  public toServerDTO(includeChildren = false): GoalServerDTO;
  public toClientDTO(includeChildren = false): GoalClientDTO;
  public static fromServerDTO(dto: GoalServerDTO): GoalClient;
  public static fromClientDTO(dto: GoalClientDTO): GoalClient;
}
```

---

### 3.2 GoalFolder èšåˆæ ¹

**èŒè´£**:

- ç®¡ç†æ–‡ä»¶å¤¹çš„å±‚çº§ç»“æ„
- æ§åˆ¶æ–‡ä»¶å¤¹çš„æ’åº
- ç®¡ç†æ–‡ä»¶å¤¹å†…çš„ç›®æ ‡é›†åˆ

**æ ¸å¿ƒå±æ€§**:

```typescript
export class GoalFolder extends AggregateRoot implements IGoalFolderServer {
  private _accountUuid: string;
  private _name: string;
  private _parentUuid: string | null; // çˆ¶æ–‡ä»¶å¤¹UUID
  private _sortOrder: number; // æ’åºé¡ºåº
  private _isSystem: boolean; // æ˜¯å¦ç³»ç»Ÿæ–‡ä»¶å¤¹
  private _icon: string | null; // å›¾æ ‡
  private _color: string | null; // é¢œè‰²
  private _createdAt: Date;
  private _updatedAt: Date;
}
```

**æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•**:

```typescript
export class GoalFolder extends AggregateRoot {
  // ===== å·¥å‚æ–¹æ³• =====
  public static create(params: CreateFolderParams): GoalFolder;
  public static createSystemFolder(name: string, accountUuid: string): GoalFolder;

  // ===== ä¸šåŠ¡æ–¹æ³• =====
  public updateName(name: string): void;
  public updateIcon(icon: string | null): void;
  public updateColor(color: string | null): void;
  public moveTo(parentUuid: string | null): void;
  public updateSortOrder(sortOrder: number): void;

  public canDelete(): boolean; // ç³»ç»Ÿæ–‡ä»¶å¤¹ä¸å¯åˆ é™¤

  // ===== DTO è½¬æ¢æ–¹æ³•ï¼ˆDomain-Server å±‚ï¼‰=====
  public toServerDTO(): GoalFolderServerDTO;
  public toPersistenceDTO(): GoalFolderPersistenceDTO;
  public static fromServerDTO(dto: GoalFolderServerDTO): GoalFolder;
  public static fromPersistenceDTO(dto: GoalFolderPersistenceDTO): GoalFolder;
}
```

**Domain-Client å±‚é¢å¤–æ–¹æ³•**:

```typescript
export class GoalFolderClient extends AggregateRoot {
  // ... åŒ Domain-Server å±‚çš„ä¸šåŠ¡æ–¹æ³•

  // ===== DTO è½¬æ¢æ–¹æ³•ï¼ˆDomain-Client å±‚ï¼‰=====
  public toServerDTO(): GoalFolderServerDTO;
  public toClientDTO(): GoalFolderClientDTO;
  public static fromServerDTO(dto: GoalFolderServerDTO): GoalFolderClient;
  public static fromClientDTO(dto: GoalFolderClientDTO): GoalFolderClient;
}
```

---

### 3.3 GoalStatistics èšåˆæ ¹

**èŒè´£**:

- èšåˆç”¨æˆ·çš„ç›®æ ‡ç»Ÿè®¡æ•°æ®
- æä¾›ç»Ÿè®¡æŸ¥è¯¢æ¥å£

**æ ¸å¿ƒå±æ€§**:

```typescript
export class GoalStatistics extends AggregateRoot implements IGoalStatisticsServer {
  private _accountUuid: string;
  private _totalGoals: number;
  private _activeGoals: number;
  private _completedGoals: number;
  private _archivedGoals: number;
  private _overallCompletionRate: number;

  // æŒ‰é‡è¦æ€§ç»Ÿè®¡
  private _goalsByImportance: Map<ImportanceLevel, number>;

  // æŒ‰ç´§æ€¥æ€§ç»Ÿè®¡
  private _goalsByUrgency: Map<UrgencyLevel, number>;

  // æ—¶é—´ç»´åº¦
  private _completedThisWeek: number;
  private _completedThisMonth: number;
  private _completedThisYear: number;

  private _lastCalculatedAt: Date;
}
```

**æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•**:

```typescript
export class GoalStatistics extends AggregateRoot {
  // ===== å·¥å‚æ–¹æ³• =====
  public static create(accountUuid: string): GoalStatistics;

  // ===== ä¸šåŠ¡æ–¹æ³• =====
  public recalculate(goals: Goal[]): void;

  // æŸ¥è¯¢æ–¹æ³•
  public getActiveGoalsCount(): number;
  public getCompletionRate(): number;
  public getGoalsByImportance(importance: ImportanceLevel): number;

  // ===== DTO è½¬æ¢æ–¹æ³•ï¼ˆDomain-Server å±‚ï¼‰=====
  public toServerDTO(): GoalStatisticsServerDTO;
  public toPersistenceDTO(): GoalStatisticsPersistenceDTO;
  public static fromServerDTO(dto: GoalStatisticsServerDTO): GoalStatistics;
  public static fromPersistenceDTO(dto: GoalStatisticsPersistenceDTO): GoalStatistics;
}
```

**Domain-Client å±‚é¢å¤–æ–¹æ³•**:

```typescript
export class GoalStatisticsClient extends AggregateRoot {
  // ... åŒ Domain-Server å±‚çš„ä¸šåŠ¡æ–¹æ³•

  // ===== DTO è½¬æ¢æ–¹æ³•ï¼ˆDomain-Client å±‚ï¼‰=====
  public toServerDTO(): GoalStatisticsServerDTO;
  public toClientDTO(): GoalStatisticsClientDTO;
  public static fromServerDTO(dto: GoalStatisticsServerDTO): GoalStatisticsClient;
  public static fromClientDTO(dto: GoalStatisticsClientDTO): GoalStatisticsClient;
}
```

---

## 4. å®ä½“è®¾è®¡

### 4.1 KeyResult å®ä½“

**èŒè´£**:

- è¡¨ç¤ºç›®æ ‡çš„ä¸€ä¸ªå…³é”®ç»“æœ
- è·Ÿè¸ªå…³é”®ç»“æœçš„è¿›åº¦
- åˆ¤æ–­å…³é”®ç»“æœæ˜¯å¦å®Œæˆ

**æ ¸å¿ƒå±æ€§**:

```typescript
export class KeyResult extends Entity implements IKeyResultServer {
  private _id: string; // å…³é”®ç»“æœIDï¼ˆéUUIDï¼‰
  private _goalUuid: string; // æ‰€å±ç›®æ ‡UUID

  private _title: string; // å…³é”®ç»“æœæ ‡é¢˜
  private _description: string | null; // æè¿°

  // è¿›åº¦è·Ÿè¸ª
  private _targetValue: number; // ç›®æ ‡å€¼
  private _currentValue: number; // å½“å‰å€¼
  private _unit: string; // å•ä½ï¼ˆä¾‹å¦‚ï¼šæ¬¡ã€ä¸ªã€%ï¼‰
  private _valueType: 'incremental' | 'absolute'; // ç´¯ç§¯å€¼ or ç»å¯¹å€¼

  // æ—¶é—´
  private _startDate: Date | null;
  private _targetDate: Date | null;

  // çŠ¶æ€
  private _isCompleted: boolean;
  private _completedAt: Date | null;

  private _createdAt: Date;
  private _updatedAt: Date;
}
```

**æ ¸å¿ƒä¸šåŠ¡æ–¹æ³•**:

```typescript
export class KeyResult extends Entity {
  // ===== å·¥å‚æ–¹æ³• =====
  public static create(params: CreateKeyResultParams): KeyResult;

  // ===== ä¸šåŠ¡æ–¹æ³• =====
  public updateProgress(currentValue: number): void;
  public incrementProgress(incrementValue: number): void;
  public complete(): void;

  // è®¡ç®—å±æ€§
  public getProgressPercentage(): number; // è®¡ç®—å®Œæˆç™¾åˆ†æ¯”
  public isOverdue(): boolean;
  public getRemainingDays(): number | null;

  // æ›´æ–°æ–¹æ³•
  public updateTitle(title: string): void;
  public updateDescription(description: string | null): void;
  public updateTargetValue(targetValue: number): void;
  public updateTargetDate(targetDate: Date | null): void;

  // ===== DTO è½¬æ¢æ–¹æ³•ï¼ˆDomain-Server å±‚ï¼‰=====
  public toServerDTO(): KeyResultServerDTO;
  public toPersistenceDTO(): KeyResultPersistenceDTO;
  public static fromServerDTO(dto: KeyResultServerDTO): KeyResult;
  public static fromPersistenceDTO(dto: KeyResultPersistenceDTO): KeyResult;
}
```

**Domain-Client å±‚é¢å¤–æ–¹æ³•**:

```typescript
export class KeyResultClient extends Entity {
  // ... åŒ Domain-Server å±‚çš„ä¸šåŠ¡æ–¹æ³•

  // ===== DTO è½¬æ¢æ–¹æ³•ï¼ˆDomain-Client å±‚ï¼‰=====
  public toServerDTO(): KeyResultServerDTO;
  public toClientDTO(): KeyResultClientDTO;
  public static fromServerDTO(dto: KeyResultServerDTO): KeyResultClient;
  public static fromClientDTO(dto: KeyResultClientDTO): KeyResultClient;
}
```

---

## 5. å€¼å¯¹è±¡è®¾è®¡

### 5.1 GoalStatus æšä¸¾ï¼ˆå€¼å¯¹è±¡ï¼‰

```typescript
export enum GoalStatus {
  Draft = 'draft', // è‰ç¨¿
  Active = 'active', // è¿›è¡Œä¸­
  Completed = 'completed', // å·²å®Œæˆ
  Archived = 'archived', // å·²å½’æ¡£
  Deleted = 'deleted', // å·²åˆ é™¤ï¼ˆé€»è¾‘åˆ é™¤ï¼‰
}
```

---

### 5.2 GoalMetadata å€¼å¯¹è±¡

```typescript
export class GoalMetadata extends ValueObject {
  constructor(
    public readonly importance: ImportanceLevel,
    public readonly urgency: UrgencyLevel,
    public readonly tags: readonly string[],
    public readonly customFields: ReadonlyMap<string, any>,
  ) {
    super();
    this.validate();
  }

  protected validate(): void {
    if (!Object.values(ImportanceLevel).includes(this.importance)) {
      throw new Error('Invalid importance level');
    }
    if (!Object.values(UrgencyLevel).includes(this.urgency)) {
      throw new Error('Invalid urgency level');
    }
  }

  public equals(other: GoalMetadata): boolean {
    return (
      this.importance === other.importance &&
      this.urgency === other.urgency &&
      this.arrayEquals(this.tags, other.tags) &&
      this.mapEquals(this.customFields, other.customFields)
    );
  }
}
```

---

### 5.3 GoalTimeRange å€¼å¯¹è±¡

```typescript
export class GoalTimeRange extends ValueObject {
  constructor(
    public readonly startDate: Date | null,
    public readonly endDate: Date | null,
  ) {
    super();
    this.validate();
  }

  protected validate(): void {
    if (this.startDate && this.endDate && this.startDate > this.endDate) {
      throw new Error('Start date must be before end date');
    }
  }

  public isOverdue(): boolean {
    if (!this.endDate) return false;
    return new Date() > this.endDate;
  }

  public getRemainingDays(): number | null {
    if (!this.endDate) return null;
    const now = new Date();
    const diff = this.endDate.getTime() - now.getTime();
    return Math.ceil(diff / (1000 * 60 * 60 * 24));
  }

  public equals(other: GoalTimeRange): boolean {
    return (
      this.startDate?.getTime() === other.startDate?.getTime() &&
      this.endDate?.getTime() === other.endDate?.getTime()
    );
  }
}
```

---

### 5.4 KeyResultProgress å€¼å¯¹è±¡

```typescript
export class KeyResultProgress extends ValueObject {
  constructor(
    public readonly currentValue: number,
    public readonly targetValue: number,
    public readonly unit: string,
    public readonly valueType: 'incremental' | 'absolute',
  ) {
    super();
    this.validate();
  }

  protected validate(): void {
    if (this.targetValue <= 0) {
      throw new Error('Target value must be positive');
    }
    if (this.currentValue < 0) {
      throw new Error('Current value cannot be negative');
    }
  }

  public getPercentage(): number {
    return Math.min(100, (this.currentValue / this.targetValue) * 100);
  }

  public isCompleted(): boolean {
    return this.currentValue >= this.targetValue;
  }

  public increment(value: number): KeyResultProgress {
    if (this.valueType !== 'incremental') {
      throw new Error('Can only increment for incremental value type');
    }
    return new KeyResultProgress(
      this.currentValue + value,
      this.targetValue,
      this.unit,
      this.valueType,
    );
  }

  public equals(other: KeyResultProgress): boolean {
    return (
      this.currentValue === other.currentValue &&
      this.targetValue === other.targetValue &&
      this.unit === other.unit &&
      this.valueType === other.valueType
    );
  }
}
```

---

## 6. ä»“å‚¨æ¥å£è®¾è®¡

### 6.1 IGoalRepository

```typescript
export interface IGoalRepository {
  // ===== åŸºæœ¬ CRUD =====
  save(goal: Goal): Promise<void>;
  findByUuid(uuid: string): Promise<Goal | null>;
  findByAccountUuid(accountUuid: string, includeDeleted?: boolean): Promise<Goal[]>;
  delete(uuid: string): Promise<void>;

  // ===== æŸ¥è¯¢æ–¹æ³• =====
  findByStatus(accountUuid: string, status: GoalStatus): Promise<Goal[]>;
  findByFolder(folderUuid: string): Promise<Goal[]>;
  findByTag(accountUuid: string, tag: string): Promise<Goal[]>;
  findOverdue(accountUuid: string): Promise<Goal[]>;

  // ===== è½¯åˆ é™¤ =====
  softDelete(uuid: string): Promise<void>;
  restore(uuid: string): Promise<void>;
  hardDelete(uuid: string): Promise<void>; // ç‰©ç†åˆ é™¤ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

  // ===== æ‰¹é‡æ“ä½œ =====
  moveToFolder(goalUuids: string[], folderUuid: string | null): Promise<void>;
  batchUpdateStatus(goalUuids: string[], status: GoalStatus): Promise<void>;
}
```

---

### 6.2 IGoalFolderRepository

```typescript
export interface IGoalFolderRepository {
  save(folder: GoalFolder): Promise<void>;
  findByUuid(uuid: string): Promise<GoalFolder | null>;
  findByAccountUuid(accountUuid: string): Promise<GoalFolder[]>;
  findByParentUuid(parentUuid: string | null): Promise<GoalFolder[]>;
  findSystemFolders(accountUuid: string): Promise<GoalFolder[]>;
  delete(uuid: string): Promise<void>;

  // æ£€æŸ¥æ˜¯å¦å­˜åœ¨å­æ–‡ä»¶å¤¹
  hasChildren(uuid: string): Promise<boolean>;
}
```

---

### 6.3 IGoalStatisticsRepository

```typescript
export interface IGoalStatisticsRepository {
  save(statistics: GoalStatistics): Promise<void>;
  findByAccountUuid(accountUuid: string): Promise<GoalStatistics | null>;
}
```

---

## 7. é¢†åŸŸæœåŠ¡è®¾è®¡

### 7.1 GoalDomainService

**èŒè´£**:

- è·¨èšåˆæ ¹çš„ä¸šåŠ¡é€»è¾‘
- å¤æ‚çš„ç›®æ ‡ç®¡ç†æ“ä½œ
- ç»Ÿè®¡æ•°æ®çš„è®¡ç®—

```typescript
export class GoalDomainService {
  constructor(
    private readonly goalRepository: IGoalRepository,
    private readonly folderRepository: IGoalFolderRepository,
    private readonly statisticsRepository: IGoalStatisticsRepository,
  ) {}

  // ===== ç›®æ ‡ç®¡ç† =====
  async createGoal(params: CreateGoalParams): Promise<Goal>;
  async updateGoal(uuid: string, params: UpdateGoalParams): Promise<Goal>;
  async deleteGoal(uuid: string): Promise<void>;
  async restoreGoal(uuid: string): Promise<void>;

  // ===== æ‰¹é‡æ“ä½œ =====
  async moveGoalsToFolder(goalUuids: string[], folderUuid: string | null): Promise<void>;
  async batchArchiveGoals(goalUuids: string[]): Promise<void>;

  // ===== ç»Ÿè®¡è®¡ç®— =====
  async recalculateStatistics(accountUuid: string): Promise<GoalStatistics>;

  // ===== æŸ¥è¯¢æœåŠ¡ =====
  async getGoalsByStatus(accountUuid: string, status: GoalStatus): Promise<Goal[]>;
  async getOverdueGoals(accountUuid: string): Promise<Goal[]>;
  async getGoalsByFolder(folderUuid: string): Promise<Goal[]>;

  // ===== æ–‡ä»¶å¤¹ç®¡ç† =====
  async createFolder(params: CreateFolderParams): Promise<GoalFolder>;
  async deleteFolder(uuid: string): Promise<void>; // ä¼šå°†ç›®æ ‡ç§»åˆ°"å…¨éƒ¨ç›®æ ‡"
  async ensureSystemFolders(accountUuid: string): Promise<void>; // ç¡®ä¿ç³»ç»Ÿæ–‡ä»¶å¤¹å­˜åœ¨
}
```

---

## 8. åº”ç”¨å±‚ä¸šåŠ¡

### 8.1 Goal åº”ç”¨æœåŠ¡

```typescript
export class GoalApplicationService {
  constructor(private readonly domainService: GoalDomainService) {}

  // ===== CRUD =====
  async createGoal(request: CreateGoalRequestDTO): Promise<GoalServerDTO>;
  async updateGoal(uuid: string, request: UpdateGoalRequestDTO): Promise<GoalServerDTO>;
  async getGoalByUuid(uuid: string): Promise<GoalServerDTO>;
  async getGoalsByAccountUuid(accountUuid: string): Promise<GoalServerDTO[]>;
  async deleteGoal(uuid: string): Promise<void>;
  async restoreGoal(uuid: string): Promise<void>;

  // ===== å…³é”®ç»“æœç®¡ç† =====
  async addKeyResult(goalUuid: string, request: CreateKeyResultRequestDTO): Promise<GoalServerDTO>;
  async updateKeyResult(
    goalUuid: string,
    keyResultId: string,
    request: UpdateKeyResultRequestDTO,
  ): Promise<GoalServerDTO>;
  async updateKeyResultProgress(
    goalUuid: string,
    keyResultId: string,
    currentValue: number,
  ): Promise<GoalServerDTO>;
  async removeKeyResult(goalUuid: string, keyResultId: string): Promise<GoalServerDTO>;

  // ===== çŠ¶æ€è½¬æ¢ =====
  async activateGoal(uuid: string): Promise<GoalServerDTO>;
  async completeGoal(uuid: string): Promise<GoalServerDTO>;
  async archiveGoal(uuid: string): Promise<GoalServerDTO>;

  // ===== æ‰¹é‡æ“ä½œ =====
  async moveGoalsToFolder(goalUuids: string[], folderUuid: string | null): Promise<void>;
  async batchArchiveGoals(goalUuids: string[]): Promise<void>;

  // ===== æŸ¥è¯¢ =====
  async getGoalsByStatus(accountUuid: string, status: GoalStatus): Promise<GoalServerDTO[]>;
  async getOverdueGoals(accountUuid: string): Promise<GoalServerDTO[]>;
  async getGoalsByFolder(folderUuid: string): Promise<GoalServerDTO[]>;
  async getGoalStatistics(accountUuid: string): Promise<GoalStatisticsServerDTO>;
}
```

---

### 8.2 GoalFolder åº”ç”¨æœåŠ¡

```typescript
export class GoalFolderApplicationService {
  constructor(private readonly domainService: GoalDomainService) {}

  async createFolder(request: CreateFolderRequestDTO): Promise<GoalFolderServerDTO>;
  async updateFolder(uuid: string, request: UpdateFolderRequestDTO): Promise<GoalFolderServerDTO>;
  async deleteFolder(uuid: string): Promise<void>;
  async getFolderTree(accountUuid: string): Promise<GoalFolderServerDTO[]>;
  async ensureSystemFolders(accountUuid: string): Promise<void>;
}
```

---

## 9. TypeScript ç±»å‹å®šä¹‰

### 9.1 æšä¸¾

```typescript
// ===== GoalStatus =====
export enum GoalStatus {
  Draft = 'draft',
  Active = 'active',
  Completed = 'completed',
  Archived = 'archived',
  Deleted = 'deleted',
}

// ===== ImportanceLevel =====
export enum ImportanceLevel {
  Vital = 'vital',
  Important = 'important',
  Moderate = 'moderate',
  Minor = 'minor',
  Trivial = 'trivial',
}

// ===== UrgencyLevel =====
export enum UrgencyLevel {
  Critical = 'critical',
  High = 'high',
  Medium = 'medium',
  Low = 'low',
  None = 'none',
}
```

---

### 9.2 Server DTO

```typescript
// ===== Goal Server DTO =====
export interface GoalServerDTO {
  uuid: string;
  accountUuid: string;
  title: string;
  description: string | null;

  startDate: string | null; // ISO 8601
  endDate: string | null; // ISO 8601
  reminderDays: number[];

  keyResults: KeyResultServerDTO[];

  importance: ImportanceLevel;
  urgency: UrgencyLevel;
  tags: string[];
  customFields: Record<string, any>;

  folderUuid: string | null;

  status: GoalStatus;
  createdAt: string; // ISO 8601
  updatedAt: string;
  completedAt: string | null;
  archivedAt: string | null;
  deletedAt: string | null;

  // è®¡ç®—å±æ€§
  overallProgress: number;
  isOverdue: boolean;
  remainingDays: number | null;
}

// ===== KeyResult Server DTO =====
export interface KeyResultServerDTO {
  id: string;
  goalUuid: string;
  title: string;
  description: string | null;

  targetValue: number;
  currentValue: number;
  unit: string;
  valueType: 'incremental' | 'absolute';

  startDate: string | null;
  targetDate: string | null;

  isCompleted: boolean;
  completedAt: string | null;

  createdAt: string;
  updatedAt: string;

  // è®¡ç®—å±æ€§
  progressPercentage: number;
}

// ===== GoalFolder Server DTO =====
export interface GoalFolderServerDTO {
  uuid: string;
  accountUuid: string;
  name: string;
  parentUuid: string | null;
  sortOrder: number;
  isSystem: boolean;
  icon: string | null;
  color: string | null;
  createdAt: string;
  updatedAt: string;
}

// ===== GoalStatistics Server DTO =====
export interface GoalStatisticsServerDTO {
  uuid: string;
  accountUuid: string;
  totalGoals: number;
  activeGoals: number;
  completedGoals: number;
  archivedGoals: number;
  overallCompletionRate: number;

  goalsByImportance: Record<ImportanceLevel, number>;
  goalsByUrgency: Record<UrgencyLevel, number>;

  completedThisWeek: number;
  completedThisMonth: number;
  completedThisYear: number;

  lastCalculatedAt: string;
}
```

---

### 9.3 Client DTO

```typescript
// ===== Goal Client DTO =====
export interface GoalClientDTO {
  uuid: string;
  accountUuid: string;
  title: string;
  description: string | null;

  startDate: Date | null;
  endDate: Date | null;
  reminderDays: number[];

  keyResults: KeyResultClientDTO[];

  importance: ImportanceLevel;
  urgency: UrgencyLevel;
  tags: string[];
  customFields: Record<string, any>;

  folderUuid: string | null;

  status: GoalStatus;
  createdAt: Date;
  updatedAt: Date;
  completedAt: Date | null;
  archivedAt: Date | null;
  deletedAt: Date | null;

  overallProgress: number;
  isOverdue: boolean;
  remainingDays: number | null;

  // UI è¾…åŠ©å­—æ®µ
  formattedCreatedAt: string;
  formattedEndDate: string;
  progressLabel: string;
}

// ===== KeyResult Client DTO =====
export interface KeyResultClientDTO {
  id: string;
  goalUuid: string;
  title: string;
  description: string | null;

  targetValue: number;
  currentValue: number;
  unit: string;
  valueType: 'incremental' | 'absolute';

  startDate: Date | null;
  targetDate: Date | null;

  isCompleted: boolean;
  completedAt: Date | null;

  createdAt: Date;
  updatedAt: Date;

  progressPercentage: number;

  // UI è¾…åŠ©å­—æ®µ
  progressLabel: string;
  formattedTargetDate: string;
}

// ===== GoalFolder Client DTO =====
export interface GoalFolderClientDTO {
  uuid: string;
  accountUuid: string;
  name: string;
  parentUuid: string | null;
  sortOrder: number;
  isSystem: boolean;
  icon: string | null;
  color: string | null;
  createdAt: Date;
  updatedAt: Date;

  // UI è¾…åŠ©å­—æ®µ
  displayName: string;
  displayIcon: string;
}

// ===== GoalStatistics Client DTO =====
export interface GoalStatisticsClientDTO {
  uuid: string;
  accountUuid: string;
  totalGoals: number;
  activeGoals: number;
  completedGoals: number;
  archivedGoals: number;
  overallCompletionRate: number;

  goalsByImportance: Record<ImportanceLevel, number>;
  goalsByUrgency: Record<UrgencyLevel, number>;

  completedThisWeek: number;
  completedThisMonth: number;
  completedThisYear: number;

  lastCalculatedAt: Date;

  // UI è¾…åŠ©å­—æ®µ
  completionRateLabel: string;
  formattedLastCalculatedAt: string;
}
```

---

### 9.4 Persistence DTO

```typescript
// ===== Goal Persistence DTO =====
export interface GoalPersistenceDTO {
  uuid: string;
  account_uuid: string;
  title: string;
  description: string | null;

  start_date: number | null; // timestamp
  end_date: number | null; // timestamp
  reminder_days: string; // JSON.stringify(number[])

  importance: string;
  urgency: string;
  tags: string; // JSON.stringify(string[])
  custom_fields: string; // JSON.stringify(Record<string, any>)

  folder_uuid: string | null;

  status: string;
  created_at: number; // timestamp
  updated_at: number; // timestamp
  completed_at: number | null;
  archived_at: number | null;
  deleted_at: number | null;
}

// ===== KeyResult Persistence DTO =====
export interface KeyResultPersistenceDTO {
  id: string;
  goal_uuid: string;
  title: string;
  description: string | null;

  target_value: number;
  current_value: number;
  unit: string;
  value_type: string;

  start_date: number | null;
  target_date: number | null;

  is_completed: boolean;
  completed_at: number | null;

  created_at: number;
  updated_at: number;
}

// ===== GoalFolder Persistence DTO =====
export interface GoalFolderPersistenceDTO {
  uuid: string;
  account_uuid: string;
  name: string;
  parent_uuid: string | null;
  sort_order: number;
  is_system: boolean;
  icon: string | null;
  color: string | null;
  created_at: number;
  updated_at: number;
}

// ===== GoalStatistics Persistence DTO =====
export interface GoalStatisticsPersistenceDTO {
  uuid: string;
  account_uuid: string;
  total_goals: number;
  active_goals: number;
  completed_goals: number;
  archived_goals: number;
  overall_completion_rate: number;

  goals_by_importance: string; // JSON.stringify
  goals_by_urgency: string; // JSON.stringify

  completed_this_week: number;
  completed_this_month: number;
  completed_this_year: number;

  last_calculated_at: number;
}
```

---

### 9.5 API Request/Response DTO

```typescript
// ===== Create Goal Request =====
export interface CreateGoalRequestDTO {
  title: string;
  description?: string;
  startDate?: string; // ISO 8601
  endDate?: string;
  reminderDays?: number[];

  keyResults: CreateKeyResultRequestDTO[];

  importance?: ImportanceLevel;
  urgency?: UrgencyLevel;
  tags?: string[];
  customFields?: Record<string, any>;

  folderUuid?: string;
}

export interface CreateKeyResultRequestDTO {
  title: string;
  description?: string;
  targetValue: number;
  unit: string;
  valueType: 'incremental' | 'absolute';
  startDate?: string;
  targetDate?: string;
}

// ===== Update Goal Request =====
export interface UpdateGoalRequestDTO {
  title?: string;
  description?: string;
  startDate?: string;
  endDate?: string;
  reminderDays?: number[];
  importance?: ImportanceLevel;
  urgency?: UrgencyLevel;
  tags?: string[];
  folderUuid?: string;
}

export interface UpdateKeyResultRequestDTO {
  title?: string;
  description?: string;
  targetValue?: number;
  unit?: string;
  targetDate?: string;
}

// ===== API Response =====
export interface GoalListResponseDTO {
  success: boolean;
  data: GoalServerDTO[];
  total: number;
  message?: string;
  timestamp: string;
}

export interface GoalResponseDTO {
  success: boolean;
  data: GoalServerDTO;
  message?: string;
  timestamp: string;
}
```

---

### 9.6 åˆ›å»ºå‚æ•°ç±»å‹

```typescript
// ===== èšåˆæ ¹åˆ›å»ºå‚æ•° =====
export interface CreateGoalParams {
  accountUuid: string;
  title: string;
  description?: string;
  startDate?: Date;
  endDate?: Date;
  reminderDays?: number[];
  keyResults: CreateKeyResultParams[];
  importance?: ImportanceLevel;
  urgency?: UrgencyLevel;
  tags?: string[];
  customFields?: Map<string, any>;
  folderUuid?: string;
}

export interface CreateKeyResultParams {
  title: string;
  description?: string;
  targetValue: number;
  currentValue?: number;
  unit: string;
  valueType: 'incremental' | 'absolute';
  startDate?: Date;
  targetDate?: Date;
}

export interface CreateFolderParams {
  accountUuid: string;
  name: string;
  parentUuid?: string;
  icon?: string;
  color?: string;
}
```

---

## ğŸ“Š æ¨¡å—ä¾èµ–å…³ç³»

```
Goal Module
    â”œâ”€â”€ Contracts (ImportanceLevel, UrgencyLevel)
    â”œâ”€â”€ Utils (AggregateRoot, Entity, ValueObject)
    â””â”€â”€ è¢«ä¾èµ–ï¼š
        â”œâ”€â”€ Task Module (Task å¯ä»¥ç»‘å®š KeyResult)
        â”œâ”€â”€ Reminder Module (Goal æé†’)
        â””â”€â”€ Notification Module (çŠ¶æ€å˜æ›´é€šçŸ¥)
```

---

## âœ… å®ç°æ£€æŸ¥æ¸…å•

### Contracts å±‚

- [ ] å®šä¹‰ GoalStatus æšä¸¾
- [ ] å®šä¹‰ ImportanceLevelã€UrgencyLevel æšä¸¾
- [ ] å®šä¹‰ GoalServerDTO
- [ ] å®šä¹‰ GoalClientDTO
- [ ] å®šä¹‰ GoalPersistenceDTO
- [ ] å®šä¹‰ KeyResultServerDTO / KeyResultClientDTO / KeyResultPersistenceDTO
- [ ] å®šä¹‰ GoalFolderServerDTO / GoalFolderClientDTO / GoalFolderPersistenceDTO
- [ ] å®šä¹‰ GoalStatisticsServerDTO / GoalStatisticsClientDTO / GoalStatisticsPersistenceDTO
- [ ] å®šä¹‰ API Request/Response DTO

### Domain-Server å±‚

- [ ] å®ç° Goal èšåˆæ ¹ï¼ˆåŒ…å« 4 ä¸ª DTO è½¬æ¢æ–¹æ³•ï¼‰
- [ ] å®ç° GoalFolder èšåˆæ ¹ï¼ˆåŒ…å« 4 ä¸ª DTO è½¬æ¢æ–¹æ³•ï¼‰
- [ ] å®ç° GoalStatistics èšåˆæ ¹ï¼ˆåŒ…å« 4 ä¸ª DTO è½¬æ¢æ–¹æ³•ï¼‰
- [ ] å®ç° KeyResult å®ä½“ï¼ˆåŒ…å« 4 ä¸ª DTO è½¬æ¢æ–¹æ³•ï¼‰
- [ ] å®ç° GoalMetadata å€¼å¯¹è±¡
- [ ] å®ç° GoalTimeRange å€¼å¯¹è±¡
- [ ] å®ç° KeyResultProgress å€¼å¯¹è±¡
- [ ] å®šä¹‰ IGoalRepository æ¥å£
- [ ] å®šä¹‰ IGoalFolderRepository æ¥å£
- [ ] å®šä¹‰ IGoalStatisticsRepository æ¥å£
- [ ] å®ç° GoalDomainService

### Domain-Client å±‚

- [ ] å®ç° GoalClient èšåˆæ ¹ï¼ˆåŒ…å« 4 ä¸ª DTO è½¬æ¢æ–¹æ³•ï¼‰
- [ ] å®ç° KeyResultClient å®ä½“ï¼ˆåŒ…å« 4 ä¸ª DTO è½¬æ¢æ–¹æ³•ï¼‰
- [ ] å®ç° GoalFolderClientï¼ˆåŒ…å« 4 ä¸ª DTO è½¬æ¢æ–¹æ³•ï¼‰
- [ ] å®ç° GoalStatisticsClientï¼ˆåŒ…å« 4 ä¸ª DTO è½¬æ¢æ–¹æ³•ï¼‰
- [ ] å®ç° DTO è½¬æ¢å·¥å…·

### API å±‚

- [ ] åˆ›å»º TypeORM Goal Entity
- [ ] åˆ›å»º TypeORM KeyResult Entity
- [ ] åˆ›å»º TypeORM GoalFolder Entity
- [ ] å®ç° GoalRepositoryImpl
- [ ] å®ç° GoalFolderRepositoryImpl
- [ ] å®ç° GoalApplicationService
- [ ] å®ç° GoalController
- [ ] å®ç° GoalFolderController
- [ ] æ³¨å†Œ GoalModule

### Web å±‚

- [ ] åˆ›å»º GoalStore (Pinia)
- [ ] åˆ›å»º GoalApplicationService (å‰ç«¯)
- [ ] åˆ›å»º GoalApiClient
- [ ] åˆ›å»º useGoal Composable
- [ ] åˆ›å»º Goal ç›¸å…³ç»„ä»¶
- [ ] åˆ›å»º Goal é¡µé¢è§†å›¾

---

## ğŸ“– ç›¸å…³æ–‡æ¡£

- [MODULE_PLAN_CORRECTIONS.md](../MODULE_PLAN_CORRECTIONS.md) - æ¨¡å—è§„åˆ’ä¿®æ­£è¯´æ˜
- [Repository æ¨¡å—å®ç°æ€»ç»“]
- [Schedule æ¨¡å—è®¾è®¡]
- [Task æ¨¡å—è§„åˆ’] _(å¾…ä¿®æ­£)_
- [Reminder æ¨¡å—è§„åˆ’] _(å¾…ä¿®æ­£)_

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.1  
**æœ€åæ›´æ–°**: 2025-01-13  
**ä¿®æ­£äºº**: GitHub Copilot
