# Feature Spec: ä»»åŠ¡æ‰¹é‡æ“ä½œä¸ä¾èµ–å›¾

> **åŠŸèƒ½ç¼–å·**: TASK-001  
> **RICE è¯„åˆ†**: 567 (Reach: 9, Impact: 7, Confidence: 9, Effort: 1)  
> **ä¼˜å…ˆçº§**: P0  
> **é¢„ä¼°æ—¶é—´**: 1-1.5 å‘¨  
> **çŠ¶æ€**: Draft  
> **è´Ÿè´£äºº**: TBD  
> **æœ€åæ›´æ–°**: 2025-10-21

---

## 1. æ¦‚è¿°ä¸ç›®æ ‡

### èƒŒæ™¯ä¸ç—›ç‚¹

åœ¨ä»»åŠ¡ç®¡ç†ä¸­ï¼Œç”¨æˆ·ç»å¸¸éœ€è¦æ‰¹é‡å¤„ç†å¤šä¸ªä»»åŠ¡ï¼Œä½†ç°çŠ¶å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- âŒ åªèƒ½é€ä¸ªæ“ä½œä»»åŠ¡ï¼Œæ•ˆç‡ä½ä¸‹ï¼ˆå¦‚æ‰¹é‡æ ‡è®°å®Œæˆã€æ‰¹é‡è®¾ç½®æ ‡ç­¾ï¼‰
- âŒ ä»»åŠ¡é—´å­˜åœ¨ä¾èµ–å…³ç³»æ—¶ï¼Œæ— æ³•å¯è§†åŒ–ä¾èµ–é“¾è·¯
- âŒ ä¸çŸ¥é“å“ªäº›ä»»åŠ¡è¢«é˜»å¡ï¼Œå“ªäº›ä»»åŠ¡é˜»å¡äº†å…¶ä»–ä»»åŠ¡
- âŒ ä»»åŠ¡ä¾èµ–å…³ç³»å¤æ‚æ—¶ï¼Œéš¾ä»¥ç†è§£æ•´ä½“ç»“æ„

### ç›®æ ‡ç”¨æˆ·

- **ä¸»è¦ç”¨æˆ·**: é¡¹ç›®ç®¡ç†è€…ã€å¤šä»»åŠ¡åè°ƒè€…
- **æ¬¡è¦ç”¨æˆ·**: å›¢é˜Ÿæˆå‘˜ï¼ˆæŸ¥çœ‹ä»»åŠ¡ä¾èµ–ï¼‰
- **å…¸å‹ç”»åƒ**: ç®¡ç† 20+ ä»»åŠ¡ï¼Œéœ€è¦æ‰¹é‡æ“ä½œå’Œä¾èµ–å¯è§†åŒ–çš„ç”¨æˆ·

### ä»·å€¼ä¸»å¼ 

**ä¸€å¥è¯ä»·å€¼**: æ”¯æŒä»»åŠ¡æ‰¹é‡æ“ä½œå’Œä¾èµ–å›¾å¯è§†åŒ–ï¼Œæå‡å¤šä»»åŠ¡ç®¡ç†æ•ˆç‡å’Œåè°ƒèƒ½åŠ›

**æ ¸å¿ƒæ”¶ç›Š**:
- âœ… æ‰¹é‡æ ‡è®°å®Œæˆã€æ‰¹é‡è®¾ç½®æ ‡ç­¾ã€æ‰¹é‡è°ƒæ•´ä¼˜å…ˆçº§ï¼ŒèŠ‚çœæ—¶é—´
- âœ… ä¾èµ–å›¾å¯è§†åŒ–ï¼Œæ¸…æ™°å±•ç¤ºä»»åŠ¡é—´çš„å‰ç½®/é˜»å¡å…³ç³»
- âœ… è‡ªåŠ¨æ£€æµ‹å¾ªç¯ä¾èµ–ï¼Œé¿å…é€»è¾‘é”™è¯¯
- âœ… è¯†åˆ«å…³é”®è·¯å¾„ï¼Œä¼˜å…ˆå¤„ç†å½±å“æœ€å¤§çš„ä»»åŠ¡

---

## 2. ç”¨æˆ·ä»·å€¼ä¸åœºæ™¯

### æ ¸å¿ƒåœºæ™¯ 1: æ‰¹é‡æ ‡è®°ä»»åŠ¡å®Œæˆ

**åœºæ™¯æè¿°**:  
ç”¨æˆ·å®Œæˆä¸€æ‰¹ä»»åŠ¡åï¼Œæ‰¹é‡æ ‡è®°ä¸º"å·²å®Œæˆ"ã€‚

**ç”¨æˆ·æ•…äº‹**:
```gherkin
As a ä»»åŠ¡æ‰§è¡Œè€…
I want æ‰¹é‡æ ‡è®°å¤šä¸ªä»»åŠ¡ä¸ºå·²å®Œæˆ
So that æˆ‘æ— éœ€é€ä¸ªç‚¹å‡»ï¼ŒèŠ‚çœæ—¶é—´
```

**æ“ä½œæµç¨‹**:
1. ç”¨æˆ·åœ¨ä»»åŠ¡åˆ—è¡¨å‹¾é€‰ 5 ä¸ªä»»åŠ¡
2. ç‚¹å‡»"æ‰¹é‡æ“ä½œ"æŒ‰é’®
3. é€‰æ‹©"æ ‡è®°ä¸ºå·²å®Œæˆ"
4. ç¡®è®¤æ“ä½œ
5. ç³»ç»Ÿæ‰¹é‡æ›´æ–°ä»»åŠ¡çŠ¶æ€ä¸º `completed`
6. æ˜¾ç¤º"å·²å®Œæˆ 5 ä¸ªä»»åŠ¡"
7. ä»»åŠ¡åˆ—è¡¨å®æ—¶æ›´æ–°

**é¢„æœŸç»“æœ**:
- æ‰¹é‡æ“ä½œæ”¯æŒï¼šæ ‡è®°å®Œæˆã€æ ‡è®°è¿›è¡Œä¸­ã€æ ‡è®°å¾…åŠã€åˆ é™¤ä»»åŠ¡
- æ“ä½œå¯æ’¤é”€ï¼ˆ30 ç§’å†…ï¼‰
- æ‰¹é‡æ“ä½œè®°å½•åˆ°å®¡è®¡æ—¥å¿—

---

### æ ¸å¿ƒåœºæ™¯ 2: æ‰¹é‡è®¾ç½®ä»»åŠ¡æ ‡ç­¾

**åœºæ™¯æè¿°**:  
ç”¨æˆ·ä¸ºä¸€æ‰¹ä»»åŠ¡æ‰¹é‡æ·»åŠ ç›¸åŒçš„æ ‡ç­¾ï¼ˆå¦‚"Sprint 3"ï¼‰ã€‚

**ç”¨æˆ·æ•…äº‹**:
```gherkin
As a é¡¹ç›®ç®¡ç†è€…
I want ä¸ºå¤šä¸ªä»»åŠ¡æ‰¹é‡æ·»åŠ æ ‡ç­¾
So that æˆ‘å¯ä»¥å¿«é€Ÿåˆ†ç±»å’Œç»„ç»‡ä»»åŠ¡
```

**æ“ä½œæµç¨‹**:
1. ç”¨æˆ·å‹¾é€‰ 8 ä¸ªä»»åŠ¡
2. ç‚¹å‡»"æ‰¹é‡æ“ä½œ" â†’ "æ·»åŠ æ ‡ç­¾"
3. è¾“å…¥æ ‡ç­¾åï¼š"Sprint 3"
4. ç‚¹å‡»"åº”ç”¨"
5. ç³»ç»Ÿä¸º 8 ä¸ªä»»åŠ¡æ·»åŠ æ ‡ç­¾
6. æ˜¾ç¤º"å·²ä¸º 8 ä¸ªä»»åŠ¡æ·»åŠ æ ‡ç­¾ 'Sprint 3'"

**é¢„æœŸç»“æœ**:
- æ”¯æŒæ‰¹é‡æ·»åŠ /ç§»é™¤æ ‡ç­¾
- æ”¯æŒæ‰¹é‡è®¾ç½®æˆªæ­¢æ—¥æœŸ
- æ”¯æŒæ‰¹é‡åˆ†é…è´Ÿè´£äºº
- æ‰¹é‡æ“ä½œé¢æ¿æ˜¾ç¤ºå½±å“çš„ä»»åŠ¡æ•°é‡

---

### æ ¸å¿ƒåœºæ™¯ 3: é…ç½®ä»»åŠ¡ä¾èµ–å…³ç³»

**åœºæ™¯æè¿°**:  
ç”¨æˆ·ä¸ºä»»åŠ¡è®¾ç½®å‰ç½®ä¾èµ–ï¼Œæ˜ç¡®ä»»åŠ¡æ‰§è¡Œé¡ºåºã€‚

**ç”¨æˆ·æ•…äº‹**:
```gherkin
As a é¡¹ç›®ç®¡ç†è€…
I want ä¸ºä»»åŠ¡è®¾ç½®å‰ç½®ä¾èµ–å…³ç³»
So that å›¢é˜ŸçŸ¥é“ä»»åŠ¡çš„æ‰§è¡Œé¡ºåº
```

**æ“ä½œæµç¨‹**:
1. ç”¨æˆ·æ‰“å¼€ä»»åŠ¡ B çš„è¯¦æƒ…é¡µ
2. ç‚¹å‡»"è®¾ç½®ä¾èµ–"
3. æœç´¢å¹¶é€‰æ‹©å‰ç½®ä»»åŠ¡ Aï¼š"å®Œæˆè®¾è®¡ç¨¿"
4. é€‰æ‹©ä¾èµ–ç±»å‹ï¼š"å®Œæˆåå¼€å§‹"ï¼ˆFinish-to-Startï¼‰
5. ä¿å­˜
6. ä»»åŠ¡ B çš„çŠ¶æ€è‡ªåŠ¨å˜ä¸º"è¢«é˜»å¡"ï¼ˆå¦‚æœä»»åŠ¡ A æœªå®Œæˆï¼‰
7. ä»»åŠ¡ B æ˜¾ç¤ºé˜»å¡æç¤ºï¼š"ç­‰å¾…ä»»åŠ¡ A å®Œæˆ"

**é¢„æœŸç»“æœ**:
- Task è¡¨æ–°å¢ `dependencies` å­—æ®µï¼š
  ```typescript
  dependencies: Array<{
    dependsOnTaskUuid: string;     // ä¾èµ–çš„ä»»åŠ¡ UUID
    dependencyType: DependencyType; // ä¾èµ–ç±»å‹
    status: 'active' | 'resolved'   // ä¾èµ–çŠ¶æ€
  }>
  ```
- æ”¯æŒ 4 ç§ä¾èµ–ç±»å‹ï¼š
  - **Finish-to-Start (FS)**: å‰ç½®ä»»åŠ¡å®Œæˆåæ‰èƒ½å¼€å§‹
  - **Start-to-Start (SS)**: å‰ç½®ä»»åŠ¡å¼€å§‹åæ‰èƒ½å¼€å§‹
  - **Finish-to-Finish (FF)**: å‰ç½®ä»»åŠ¡å®Œæˆåæ‰èƒ½å®Œæˆ
  - **Start-to-Finish (SF)**: å‰ç½®ä»»åŠ¡å¼€å§‹åæ‰èƒ½å®Œæˆï¼ˆç½•è§ï¼‰

---

### æ ¸å¿ƒåœºæ™¯ 4: æŸ¥çœ‹ä»»åŠ¡ä¾èµ–å›¾

**åœºæ™¯æè¿°**:  
ç”¨æˆ·æŸ¥çœ‹ä»»åŠ¡é—´çš„ä¾èµ–å…³ç³»å›¾ï¼Œè¯†åˆ«é˜»å¡é“¾è·¯å’Œå…³é”®è·¯å¾„ã€‚

**ç”¨æˆ·æ•…äº‹**:
```gherkin
As a é¡¹ç›®ç®¡ç†è€…
I want æŸ¥çœ‹ä»»åŠ¡ä¾èµ–å…³ç³»çš„å¯è§†åŒ–å›¾è¡¨
So that æˆ‘å¯ä»¥ç†è§£ä»»åŠ¡é—´çš„å¤æ‚ä¾èµ–ç»“æ„
```

**æ“ä½œæµç¨‹**:
1. ç”¨æˆ·ç‚¹å‡»"ä¾èµ–å›¾"è§†å›¾
2. ç³»ç»Ÿå±•ç¤ºæœ‰å‘å›¾ï¼ˆDAGï¼‰ï¼š
   ```
   ä»»åŠ¡ A â”€â”€â†’ ä»»åŠ¡ B â”€â”€â†’ ä»»åŠ¡ D
             â†“
           ä»»åŠ¡ C â”€â”€â†’ ä»»åŠ¡ E
   ```
3. å·²å®Œæˆä»»åŠ¡æ˜¾ç¤ºä¸ºç»¿è‰²
4. è¢«é˜»å¡ä»»åŠ¡æ˜¾ç¤ºä¸ºçº¢è‰²ï¼ˆè¾¹æ¡†é—ªçƒï¼‰
5. å…³é”®è·¯å¾„é«˜äº®æ˜¾ç¤ºï¼ˆæœ€é•¿è·¯å¾„ï¼‰
6. ç”¨æˆ·å¯ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
7. ç”¨æˆ·å¯æ‹–æ‹½èŠ‚ç‚¹è°ƒæ•´å¸ƒå±€

**é¢„æœŸç»“æœ**:
- ä½¿ç”¨å›¾å½¢åº“ï¼ˆå¦‚ **React Flow** æˆ– **Cytoscape.js**ï¼‰æ¸²æŸ“ä¾èµ–å›¾
- èŠ‚ç‚¹é¢œè‰²ç¼–ç ï¼š
  - ğŸŸ¢ ç»¿è‰²ï¼šå·²å®Œæˆ
  - ğŸ”µ è“è‰²ï¼šè¿›è¡Œä¸­
  - âšª ç°è‰²ï¼šå¾…åŠ
  - ğŸ”´ çº¢è‰²ï¼šè¢«é˜»å¡
- è¾¹ç±»å‹æ ‡æ³¨ï¼ˆFS, SS, FF, SFï¼‰
- æ”¯æŒç¼©æ”¾ã€å¹³ç§»ã€å…¨å±æŸ¥çœ‹

---

### æ ¸å¿ƒåœºæ™¯ 5: è‡ªåŠ¨æ£€æµ‹å¾ªç¯ä¾èµ–

**åœºæ™¯æè¿°**:  
ç”¨æˆ·å°è¯•åˆ›å»ºå¾ªç¯ä¾èµ–æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶é˜»æ­¢ã€‚

**ç”¨æˆ·æ•…äº‹**:
```gherkin
As a é¡¹ç›®ç®¡ç†è€…
I want ç³»ç»Ÿè‡ªåŠ¨æ£€æµ‹å¹¶é˜»æ­¢å¾ªç¯ä¾èµ–
So that ä»»åŠ¡ä¾èµ–å…³ç³»ä¿æŒé€»è¾‘ä¸€è‡´æ€§
```

**æ“ä½œæµç¨‹**:
1. å·²æœ‰ä¾èµ–é“¾ï¼šä»»åŠ¡ A â†’ ä»»åŠ¡ B â†’ ä»»åŠ¡ C
2. ç”¨æˆ·å°è¯•ä¸ºä»»åŠ¡ A è®¾ç½®å‰ç½®ä¾èµ–ï¼šä»»åŠ¡ C
3. ç³»ç»Ÿæ£€æµ‹åˆ°å¾ªç¯ï¼šA â†’ B â†’ C â†’ A
4. æ˜¾ç¤ºé”™è¯¯æç¤ºï¼š"æ— æ³•åˆ›å»ºä¾èµ–ï¼šæ£€æµ‹åˆ°å¾ªç¯ä¾èµ–ï¼ˆA â†’ B â†’ C â†’ Aï¼‰"
5. æ“ä½œè¢«å–æ¶ˆ

**é¢„æœŸç»“æœ**:
- ä½¿ç”¨æ‹“æ‰‘æ’åºç®—æ³•æ£€æµ‹å¾ªç¯
- å®æ—¶æ ¡éªŒï¼Œé¿å…ä¿å­˜é”™è¯¯æ•°æ®
- æ˜¾ç¤ºå¾ªç¯è·¯å¾„ï¼Œå¸®åŠ©ç”¨æˆ·ç†è§£é—®é¢˜

---

### æ ¸å¿ƒåœºæ™¯ 6: æ‰¹é‡åˆ é™¤ä»»åŠ¡åŠå…¶ä¾èµ–

**åœºæ™¯æè¿°**:  
ç”¨æˆ·æ‰¹é‡åˆ é™¤ä»»åŠ¡æ—¶ï¼Œç³»ç»Ÿè‡ªåŠ¨å¤„ç†ç›¸å…³çš„ä¾èµ–å…³ç³»ã€‚

**ç”¨æˆ·æ•…äº‹**:
```gherkin
As a é¡¹ç›®ç®¡ç†è€…
I want æ‰¹é‡åˆ é™¤ä»»åŠ¡æ—¶è‡ªåŠ¨è§£é™¤ä¾èµ–å…³ç³»
So that æ•°æ®ä¿æŒä¸€è‡´æ€§
```

**æ“ä½œæµç¨‹**:
1. ç”¨æˆ·å‹¾é€‰ 3 ä¸ªä»»åŠ¡ï¼šA, B, C
2. ç‚¹å‡»"æ‰¹é‡åˆ é™¤"
3. ç³»ç»Ÿæ£€æµ‹åˆ°ä»»åŠ¡ D ä¾èµ–äºä»»åŠ¡ B
4. æ˜¾ç¤ºè­¦å‘Šï¼š"ä»»åŠ¡ D ä¾èµ–äºä»»åŠ¡ Bï¼Œåˆ é™¤å D å°†ä¸å†è¢«é˜»å¡"
5. ç”¨æˆ·ç¡®è®¤åˆ é™¤
6. ç³»ç»Ÿåˆ é™¤ A, B, Cï¼Œå¹¶è‡ªåŠ¨è§£é™¤ D å¯¹ B çš„ä¾èµ–
7. ä»»åŠ¡ D çŠ¶æ€ä»"è¢«é˜»å¡"å˜ä¸º"å¾…åŠ"

**é¢„æœŸç»“æœ**:
- æ‰¹é‡åˆ é™¤å‰æ˜¾ç¤ºå½±å“åˆ†æ
- è‡ªåŠ¨æ¸…ç†å­¤ç«‹çš„ä¾èµ–è®°å½•
- é€šçŸ¥å—å½±å“çš„ä»»åŠ¡è´Ÿè´£äºº

---

## 3. è®¾è®¡è¦ç‚¹

### æ¶‰åŠå­—æ®µï¼ˆå¯¹é½ Contractsï¼‰

#### æ›´æ–°èšåˆæ ¹ï¼šTask

**ä½ç½®**: `packages/contracts/src/modules/task/aggregates/TaskServer.ts`

```typescript
export interface TaskServerDTO {
  // ...existing fields...
  
  // ä¾èµ–å…³ç³»å­—æ®µ
  readonly dependencies?: TaskDependency[];     // æ­¤ä»»åŠ¡ä¾èµ–çš„å…¶ä»–ä»»åŠ¡
  readonly dependents?: string[];               // ä¾èµ–æ­¤ä»»åŠ¡çš„å…¶ä»–ä»»åŠ¡ UUIDï¼ˆåå‘å…³ç³»ï¼‰
  readonly isBlocked: boolean;                  // æ˜¯å¦è¢«é˜»å¡
  readonly blockingReason?: string;             // é˜»å¡åŸå› 
  readonly dependencyStatus: DependencyStatus;  // ä¾èµ–çŠ¶æ€
}

/**
 * ä»»åŠ¡ä¾èµ–å…³ç³»
 */
export interface TaskDependency {
  readonly dependsOnTaskUuid: string;           // ä¾èµ–çš„ä»»åŠ¡ UUID
  readonly dependencyType: DependencyType;       // ä¾èµ–ç±»å‹
  readonly status: 'active' | 'resolved';        // ä¾èµ–çŠ¶æ€
  readonly createdAt: number;
  readonly createdBy: string;
}

/**
 * ä¾èµ–ç±»å‹
 */
export enum DependencyType {
  FINISH_TO_START = 'finish_to_start',  // å®Œæˆåå¼€å§‹ï¼ˆæœ€å¸¸è§ï¼‰
  START_TO_START = 'start_to_start',    // å¼€å§‹åå¼€å§‹
  FINISH_TO_FINISH = 'finish_to_finish', // å®Œæˆåå®Œæˆ
  START_TO_FINISH = 'start_to_finish'   // å¼€å§‹åå®Œæˆï¼ˆç½•è§ï¼‰
}

/**
 * ä¾èµ–çŠ¶æ€
 */
export enum DependencyStatus {
  NONE = 'none',              // æ— ä¾èµ–
  WAITING = 'waiting',        // ç­‰å¾…å‰ç½®ä»»åŠ¡
  READY = 'ready',            // ä¾èµ–å·²è§£é™¤ï¼Œå¯ä»¥å¼€å§‹
  BLOCKED = 'blocked'         // è¢«é˜»å¡ï¼ˆå¾ªç¯ä¾èµ–æˆ–å¼‚å¸¸ï¼‰
}
```

---

### äº¤äº’è®¾è®¡

#### 1. æ‰¹é‡æ“ä½œæ”¯æŒçš„åŠ¨ä½œ

| æ“ä½œ | æè¿° | å‰ç½®æ£€æŸ¥ |
|------|------|---------|
| æ ‡è®°å®Œæˆ | æ‰¹é‡å°†çŠ¶æ€æ”¹ä¸º `completed` | æ£€æŸ¥æ˜¯å¦æœ‰ä¾èµ–æ­¤ä»»åŠ¡çš„æœªå®Œæˆä»»åŠ¡ |
| æ ‡è®°è¿›è¡Œä¸­ | æ‰¹é‡å°†çŠ¶æ€æ”¹ä¸º `in_progress` | æ£€æŸ¥å‰ç½®ä¾èµ–æ˜¯å¦å·²è§£é™¤ |
| åˆ é™¤ä»»åŠ¡ | æ‰¹é‡åˆ é™¤ä»»åŠ¡ | æ£€æŸ¥ä¾èµ–å…³ç³»ï¼Œæ˜¾ç¤ºå½±å“åˆ†æ |
| æ·»åŠ æ ‡ç­¾ | æ‰¹é‡æ·»åŠ æ ‡ç­¾ | æ—  |
| ç§»é™¤æ ‡ç­¾ | æ‰¹é‡ç§»é™¤æ ‡ç­¾ | æ—  |
| è®¾ç½®ä¼˜å…ˆçº§ | æ‰¹é‡è®¾ç½® importance/urgency | æ—  |
| åˆ†é…è´Ÿè´£äºº | æ‰¹é‡åˆ†é… assignee | æ—  |
| è®¾ç½®æˆªæ­¢æ—¥æœŸ | æ‰¹é‡è®¾ç½® dueDate | æ—  |

#### 2. ä¾èµ–å…³ç³»è‡ªåŠ¨æ›´æ–°è§„åˆ™

- âœ… å‰ç½®ä»»åŠ¡å®Œæˆæ—¶ï¼Œè‡ªåŠ¨è§£é™¤ä¾èµ–ä»»åŠ¡çš„é˜»å¡çŠ¶æ€
- âœ… å‰ç½®ä»»åŠ¡é‡æ–°å¼€å¯æ—¶ï¼Œé‡æ–°é˜»å¡ä¾èµ–ä»»åŠ¡
- âœ… åˆ é™¤ä»»åŠ¡æ—¶ï¼Œè‡ªåŠ¨æ¸…ç†ç›¸å…³ä¾èµ–è®°å½•
- âœ… åˆ›å»ºä¾èµ–æ—¶ï¼Œç«‹å³æ£€æµ‹å¾ªç¯ä¾èµ–

#### 3. ä¾èµ–å›¾å¸ƒå±€ç®—æ³•

- **åˆ†å±‚å¸ƒå±€ï¼ˆHierarchical Layoutï¼‰**: è‡ªåŠ¨å°†ä»»åŠ¡åˆ†å±‚ï¼Œä¸Šå±‚ä¸ºå‰ç½®ä»»åŠ¡
- **åŠ›å¯¼å‘å¸ƒå±€ï¼ˆForce-Directed Layoutï¼‰**: ä»»åŠ¡èŠ‚ç‚¹è‡ªç„¶åˆ†å¸ƒï¼Œé¿å…é‡å 
- **æ‰‹åŠ¨å¸ƒå±€**: ç”¨æˆ·å¯æ‹–æ‹½è°ƒæ•´ï¼Œä¿å­˜è‡ªå®šä¹‰ä½ç½®

---

## 4. MVP/MMP/Full è·¯å¾„

### MVP: åŸºç¡€æ‰¹é‡æ“ä½œï¼ˆ1-1.5 å‘¨ï¼‰

**èŒƒå›´**:
- âœ… æ‰¹é‡æ ‡è®°å®Œæˆ/è¿›è¡Œä¸­/å¾…åŠ
- âœ… æ‰¹é‡åˆ é™¤ä»»åŠ¡
- âœ… æ‰¹é‡æ·»åŠ /ç§»é™¤æ ‡ç­¾
- âœ… æ‰¹é‡æ“ä½œæ’¤é”€åŠŸèƒ½
- âœ… åŸºç¡€ä¾èµ–å…³ç³»é…ç½®ï¼ˆä»…æ”¯æŒ Finish-to-Startï¼‰
- âœ… ç®€å•ä¾èµ–åˆ—è¡¨è§†å›¾ï¼ˆéå›¾å½¢åŒ–ï¼‰

**æŠ€æœ¯è¦ç‚¹**:
- Contracts: å®šä¹‰ `TaskDependency`, `DependencyType`
- Domain: Task èšåˆæ ¹æ·»åŠ  `addDependency()`, `removeDependency()` æ–¹æ³•
- Application: `BatchUpdateTasksService` åº”ç”¨æœåŠ¡
- Prisma: æ·»åŠ  `TaskDependency` è¡¨ï¼ˆå…³è”è¡¨ï¼‰
- API: `POST /api/v1/tasks/batch/update`, `POST /api/v1/tasks/:id/dependencies`
- UI: æ‰¹é‡æ“ä½œé¢æ¿ + ä¾èµ–é…ç½®è¡¨å•

**éªŒæ”¶æ ‡å‡†**:
```gherkin
Given ç”¨æˆ·å‹¾é€‰äº† 5 ä¸ªä»»åŠ¡
When ç”¨æˆ·ç‚¹å‡»"æ‰¹é‡æ“ä½œ" â†’ "æ ‡è®°ä¸ºå·²å®Œæˆ"
Then ç³»ç»Ÿåº”æ‰¹é‡æ›´æ–° 5 ä¸ªä»»åŠ¡çŠ¶æ€ä¸º completed
And æ˜¾ç¤º"å·²å®Œæˆ 5 ä¸ªä»»åŠ¡"
And ç”¨æˆ·å¯åœ¨ 30 ç§’å†…ç‚¹å‡»"æ’¤é”€"æ¢å¤
```

---

### MMP: ä¾èµ–å›¾å¯è§†åŒ–ï¼ˆ+1-2 å‘¨ï¼‰

**åœ¨ MVP åŸºç¡€ä¸Šæ–°å¢**:
- âœ… ä¾èµ–å›¾å¯è§†åŒ–ï¼ˆä½¿ç”¨ React Flowï¼‰
- âœ… æ”¯æŒ 4 ç§ä¾èµ–ç±»å‹ï¼ˆFS, SS, FF, SFï¼‰
- âœ… è‡ªåŠ¨æ£€æµ‹å¾ªç¯ä¾èµ–
- âœ… å…³é”®è·¯å¾„è¯†åˆ«
- âœ… é˜»å¡ä»»åŠ¡é«˜äº®æ˜¾ç¤º
- âœ… æ‰¹é‡è®¾ç½®ä¼˜å…ˆçº§ã€æˆªæ­¢æ—¥æœŸ

**æŠ€æœ¯è¦ç‚¹**:
- é›†æˆ React Flow æˆ– Cytoscape.js
- æ‹“æ‰‘æ’åºç®—æ³•ï¼ˆæ£€æµ‹å¾ªç¯ï¼‰
- å…³é”®è·¯å¾„ç®—æ³•ï¼ˆæœ€é•¿è·¯å¾„ï¼‰
- ä¾èµ–å›¾æ•°æ®ç»“æ„ä¼˜åŒ–

**éªŒæ”¶æ ‡å‡†**:
```gherkin
Given ä»»åŠ¡åˆ—è¡¨æœ‰ä¾èµ–å…³ç³»ï¼šA â†’ B â†’ C, A â†’ D
When ç”¨æˆ·ç‚¹å‡»"ä¾èµ–å›¾"è§†å›¾
Then ç³»ç»Ÿåº”å±•ç¤ºæœ‰å‘å›¾
And ä»»åŠ¡èŠ‚ç‚¹åº”æŒ‰å±‚æ¬¡æ’åˆ—
And å·²å®Œæˆä»»åŠ¡åº”æ˜¾ç¤ºä¸ºç»¿è‰²
And è¢«é˜»å¡ä»»åŠ¡åº”æ˜¾ç¤ºä¸ºçº¢è‰²
And å…³é”®è·¯å¾„ï¼ˆA â†’ B â†’ Cï¼‰åº”é«˜äº®æ˜¾ç¤º
```

---

### Full Release: æ™ºèƒ½ä¾èµ–ç®¡ç†ï¼ˆ+2-3 å‘¨ï¼‰

**åœ¨ MMP åŸºç¡€ä¸Šæ–°å¢**:
- âœ… æ™ºèƒ½æ¨èä¾èµ–å…³ç³»ï¼ˆåŸºäºä»»åŠ¡æè¿°å’Œæ ‡ç­¾ï¼‰
- âœ… ä¾èµ–æ¨¡æ¿ï¼ˆå¸¸è§é¡¹ç›®æµç¨‹é¢„è®¾ï¼‰
- âœ… æ‰¹é‡é…ç½®ä¾èµ–å…³ç³»
- âœ… ä¾èµ–å½±å“åˆ†æï¼ˆå¦‚æœ A å»¶æœŸï¼Œå½±å“å“ªäº›ä»»åŠ¡ï¼‰
- âœ… ç”˜ç‰¹å›¾è§†å›¾ï¼ˆåŸºäºä¾èµ–å…³ç³»ç”Ÿæˆæ—¶é—´çº¿ï¼‰
- âœ… æ‰¹é‡å¯¼å…¥/å¯¼å‡ºä»»åŠ¡ï¼ˆCSV/JSONï¼‰

**æŠ€æœ¯è¦ç‚¹**:
- NLP åˆ†æä»»åŠ¡æè¿°ï¼Œæ¨èä¾èµ–
- ç”˜ç‰¹å›¾æ¸²æŸ“ï¼ˆå¦‚ dhtmlx-ganttï¼‰
- CSV/JSON å¯¼å…¥å¯¼å‡ºæœåŠ¡

**éªŒæ”¶æ ‡å‡†**:
```gherkin
Given ç”¨æˆ·åˆ›å»ºä»»åŠ¡"å‰ç«¯å¼€å‘"
When ç³»ç»Ÿæ£€æµ‹åˆ°å·²æœ‰ä»»åŠ¡"UI è®¾è®¡"
Then ç³»ç»Ÿåº”æ¨è"UI è®¾è®¡"ä½œä¸ºå‰ç½®ä¾èµ–
And ç”¨æˆ·å¯ä¸€é”®æ¥å—æ¨è
And ä¾èµ–å…³ç³»è‡ªåŠ¨åˆ›å»º
```

---

## 5. éªŒæ”¶æ ‡å‡†ï¼ˆGherkinï¼‰

### Feature: ä»»åŠ¡æ‰¹é‡æ“ä½œä¸ä¾èµ–å›¾

#### Scenario 1: æ‰¹é‡æ ‡è®°ä»»åŠ¡å®Œæˆ

```gherkin
Feature: ä»»åŠ¡æ‰¹é‡æ“ä½œä¸ä¾èµ–å›¾
  ä½œä¸ºé¡¹ç›®ç®¡ç†è€…ï¼Œæˆ‘å¸Œæœ›æ‰¹é‡æ“ä½œä»»åŠ¡å¹¶å¯è§†åŒ–ä¾èµ–å…³ç³»

  Background:
    Given ç”¨æˆ·"å­™ä¸ƒ"å·²ç™»å½•
    And ä»»åŠ¡åˆ—è¡¨æœ‰ä»¥ä¸‹ä»»åŠ¡ï¼š
      | uuid    | name        | status      |
      | task-1  | è®¾è®¡åŸå‹    | completed   |
      | task-2  | å¼€å‘å‰ç«¯    | in_progress |
      | task-3  | å¼€å‘åç«¯    | in_progress |
      | task-4  | ç¼–å†™æµ‹è¯•    | todo        |
      | task-5  | éƒ¨ç½²ä¸Šçº¿    | todo        |

  Scenario: æ‰¹é‡æ ‡è®°ä¸ºå·²å®Œæˆ
    When ç”¨æˆ·å‹¾é€‰ä»»åŠ¡ï¼štask-2, task-3
    And ç‚¹å‡»"æ‰¹é‡æ“ä½œ" â†’ "æ ‡è®°ä¸ºå·²å®Œæˆ"
    And ç¡®è®¤æ“ä½œ
    Then ä»»åŠ¡ task-2 çš„çŠ¶æ€åº”å˜ä¸º completed
    And ä»»åŠ¡ task-3 çš„çŠ¶æ€åº”å˜ä¸º completed
    And ç³»ç»Ÿåº”æ˜¾ç¤º"å·²å®Œæˆ 2 ä¸ªä»»åŠ¡"
    And æ‰¹é‡æ“ä½œåº”è®°å½•åˆ°å®¡è®¡æ—¥å¿—ï¼š
      | æ“ä½œç±»å‹   | å½±å“ä»»åŠ¡æ•° | æ“ä½œäºº | æ—¶é—´              |
      | æ ‡è®°å®Œæˆ   | 2          | å­™ä¸ƒ   | 2025-10-21 16:00 |

  Scenario: æ‰¹é‡æ“ä½œæ’¤é”€
    Given ç”¨æˆ·åˆšå®Œæˆæ‰¹é‡æ ‡è®°æ“ä½œ
    And æ’¤é”€æŒ‰é’®å¯è§ï¼ˆ30 ç§’å†…ï¼‰
    When ç”¨æˆ·ç‚¹å‡»"æ’¤é”€"
    Then ä»»åŠ¡ task-2, task-3 çš„çŠ¶æ€åº”æ¢å¤ä¸º in_progress
    And æ˜¾ç¤º"æ“ä½œå·²æ’¤é”€"
```

---

#### Scenario 2: é…ç½®ä»»åŠ¡ä¾èµ–å…³ç³»

```gherkin
  Background:
    Given ä»»åŠ¡"å¼€å‘å‰ç«¯"ï¼ˆtask-2ï¼‰å·²å­˜åœ¨
    And ä»»åŠ¡"è®¾è®¡åŸå‹"ï¼ˆtask-1ï¼‰çŠ¶æ€ä¸º completed

  Scenario: è®¾ç½®å‰ç½®ä¾èµ–
    When ç”¨æˆ·æ‰“å¼€ä»»åŠ¡ task-2 çš„è¯¦æƒ…é¡µ
    And ç‚¹å‡»"è®¾ç½®ä¾èµ–"
    And æœç´¢å¹¶é€‰æ‹©å‰ç½®ä»»åŠ¡ task-1ï¼ˆè®¾è®¡åŸå‹ï¼‰
    And é€‰æ‹©ä¾èµ–ç±»å‹ = "å®Œæˆåå¼€å§‹"ï¼ˆFinish-to-Startï¼‰
    And ä¿å­˜
    Then ä»»åŠ¡ task-2 åº”æ–°å¢ä¾èµ–è®°å½•ï¼š
      | dependsOnTaskUuid | dependencyType   | status   |
      | task-1            | finish_to_start  | resolved |
    And ä»»åŠ¡ task-2 çš„ isBlocked åº”ä¸º falseï¼ˆå› ä¸º task-1 å·²å®Œæˆï¼‰
    And ä»»åŠ¡ task-1 çš„ dependents åº”åŒ…å« task-2

  Scenario: ä¾èµ–æœªå®Œæˆæ—¶è‡ªåŠ¨é˜»å¡
    Given ä»»åŠ¡ task-3ï¼ˆå¼€å‘åç«¯ï¼‰ä¾èµ–ä»»åŠ¡ task-2ï¼ˆå¼€å‘å‰ç«¯ï¼‰
    And ä»»åŠ¡ task-2 çŠ¶æ€ä¸º in_progressï¼ˆæœªå®Œæˆï¼‰
    When ç”¨æˆ·æŸ¥çœ‹ä»»åŠ¡ task-3
    Then ä»»åŠ¡ task-3 çš„ isBlocked åº”ä¸º true
    And ä»»åŠ¡ task-3 åº”æ˜¾ç¤ºé˜»å¡æç¤ºï¼š"ç­‰å¾…ä»»åŠ¡'å¼€å‘å‰ç«¯'å®Œæˆ"
    And ä»»åŠ¡ task-3 çš„çŠ¶æ€æ ‡ç­¾åº”å¸¦çº¢è‰²è­¦å‘Šæ ‡è¯†
```

---

#### Scenario 3: æŸ¥çœ‹ä»»åŠ¡ä¾èµ–å›¾

```gherkin
  Background:
    Given ä»»åŠ¡åˆ—è¡¨æœ‰ä»¥ä¸‹ä¾èµ–å…³ç³»ï¼š
      | ä»»åŠ¡        | ä¾èµ–äº         |
      | å¼€å‘å‰ç«¯    | è®¾è®¡åŸå‹       |
      | å¼€å‘åç«¯    | è®¾è®¡åŸå‹       |
      | ç¼–å†™æµ‹è¯•    | å¼€å‘å‰ç«¯, å¼€å‘åç«¯ |
      | éƒ¨ç½²ä¸Šçº¿    | ç¼–å†™æµ‹è¯•       |

  Scenario: å±•ç¤ºä¾èµ–å›¾
    When ç”¨æˆ·ç‚¹å‡»"ä¾èµ–å›¾"è§†å›¾
    Then ç³»ç»Ÿåº”å±•ç¤ºæœ‰å‘å›¾ï¼ŒåŒ…å« 5 ä¸ªèŠ‚ç‚¹
    And ä¾èµ–å…³ç³»åº”æ˜¾ç¤ºä¸ºæœ‰å‘è¾¹ï¼š
      | èµ·ç‚¹     | ç»ˆç‚¹     |
      | è®¾è®¡åŸå‹ | å¼€å‘å‰ç«¯ |
      | è®¾è®¡åŸå‹ | å¼€å‘åç«¯ |
      | å¼€å‘å‰ç«¯ | ç¼–å†™æµ‹è¯• |
      | å¼€å‘åç«¯ | ç¼–å†™æµ‹è¯• |
      | ç¼–å†™æµ‹è¯• | éƒ¨ç½²ä¸Šçº¿ |
    And å·²å®Œæˆä»»åŠ¡ï¼ˆè®¾è®¡åŸå‹ï¼‰åº”æ˜¾ç¤ºä¸ºç»¿è‰²
    And è¢«é˜»å¡ä»»åŠ¡ï¼ˆéƒ¨ç½²ä¸Šçº¿ï¼‰åº”æ˜¾ç¤ºä¸ºçº¢è‰²
    And å…³é”®è·¯å¾„ï¼ˆè®¾è®¡åŸå‹ â†’ å¼€å‘å‰ç«¯ â†’ ç¼–å†™æµ‹è¯• â†’ éƒ¨ç½²ä¸Šçº¿ï¼‰åº”é«˜äº®

  Scenario: ç‚¹å‡»èŠ‚ç‚¹æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
    Given ä¾èµ–å›¾å·²å±•ç¤º
    When ç”¨æˆ·ç‚¹å‡»èŠ‚ç‚¹"å¼€å‘å‰ç«¯"
    Then ç³»ç»Ÿåº”å¼¹å‡ºä»»åŠ¡è¯¦æƒ…é¢æ¿
    And é¢æ¿åº”æ˜¾ç¤ºä»»åŠ¡ä¿¡æ¯ï¼šåç§°ã€çŠ¶æ€ã€ä¼˜å…ˆçº§ã€è´Ÿè´£äºº
    And é¢æ¿åº”æ˜¾ç¤ºä¾èµ–å…³ç³»ï¼š"ä¾èµ–äº'è®¾è®¡åŸå‹'"
    And é¢æ¿åº”æ˜¾ç¤º"è¢«'ç¼–å†™æµ‹è¯•'ä¾èµ–"
```

---

#### Scenario 4: æ£€æµ‹å¾ªç¯ä¾èµ–

```gherkin
  Background:
    Given å·²æœ‰ä¾èµ–é“¾ï¼štask-1 â†’ task-2 â†’ task-3

  Scenario: é˜»æ­¢åˆ›å»ºå¾ªç¯ä¾èµ–
    When ç”¨æˆ·å°è¯•ä¸º task-1 è®¾ç½®å‰ç½®ä¾èµ– task-3
    Then ç³»ç»Ÿåº”æ˜¾ç¤ºé”™è¯¯æç¤ºï¼š"æ— æ³•åˆ›å»ºä¾èµ–ï¼šæ£€æµ‹åˆ°å¾ªç¯ä¾èµ–"
    And æç¤ºåº”æ˜¾ç¤ºå¾ªç¯è·¯å¾„ï¼š"task-1 â†’ task-2 â†’ task-3 â†’ task-1"
    And æ“ä½œåº”è¢«å–æ¶ˆ
    And ä¾èµ–å…³ç³»ä¸åº”ä¿å­˜

  Scenario: å®æ—¶æ ¡éªŒå¾ªç¯ä¾èµ–
    When ç”¨æˆ·åœ¨ä¾èµ–é…ç½®è¡¨å•ä¸­é€‰æ‹© task-3
    And å°šæœªç‚¹å‡»"ä¿å­˜"
    Then è¡¨å•åº”å®æ—¶æ˜¾ç¤ºè­¦å‘Šï¼š"æ­¤æ“ä½œå°†åˆ›å»ºå¾ªç¯ä¾èµ–"
    And "ä¿å­˜"æŒ‰é’®åº”ç¦ç”¨
```

---

#### Scenario 5: æ‰¹é‡åˆ é™¤ä»»åŠ¡åŠä¾èµ–å¤„ç†

```gherkin
  Background:
    Given ä»»åŠ¡ task-2 ä¾èµ–ä»»åŠ¡ task-1
    And ä»»åŠ¡ task-3 ä¾èµ–ä»»åŠ¡ task-2

  Scenario: åˆ é™¤ä¸­é—´ä»»åŠ¡å¹¶å¤„ç†ä¾èµ–
    When ç”¨æˆ·å‹¾é€‰ä»»åŠ¡ task-2
    And ç‚¹å‡»"æ‰¹é‡åˆ é™¤"
    Then ç³»ç»Ÿåº”æ˜¾ç¤ºè­¦å‘Šå¯¹è¯æ¡†ï¼š
      """
      ä»»åŠ¡'å¼€å‘å‰ç«¯'è¢«ä»¥ä¸‹ä»»åŠ¡ä¾èµ–ï¼š
      - ç¼–å†™æµ‹è¯•ï¼ˆtask-3ï¼‰
      
      åˆ é™¤åï¼Œtask-3 å°†ä¸å†è¢«é˜»å¡ã€‚
      æ˜¯å¦ç»§ç»­åˆ é™¤ï¼Ÿ
      """
    When ç”¨æˆ·ç¡®è®¤åˆ é™¤
    Then ä»»åŠ¡ task-2 åº”è¢«åˆ é™¤
    And ä»»åŠ¡ task-3 çš„ä¾èµ–è®°å½•åº”è‡ªåŠ¨åˆ é™¤
    And ä»»åŠ¡ task-3 çš„ isBlocked åº”å˜ä¸º false
    And ç³»ç»Ÿåº”å‘é€é€šçŸ¥ç»™ task-3 çš„è´Ÿè´£äººï¼š"å‰ç½®ä»»åŠ¡å·²åˆ é™¤"
```

---

#### Scenario 6: æ‰¹é‡è®¾ç½®æ ‡ç­¾

```gherkin
  Background:
    Given ç”¨æˆ·å‹¾é€‰äº† 5 ä¸ªä»»åŠ¡

  Scenario: æ‰¹é‡æ·»åŠ æ ‡ç­¾
    When ç”¨æˆ·ç‚¹å‡»"æ‰¹é‡æ“ä½œ" â†’ "æ·»åŠ æ ‡ç­¾"
    And è¾“å…¥æ ‡ç­¾åï¼š"Sprint 3"
    And ç‚¹å‡»"åº”ç”¨"
    Then ç³»ç»Ÿåº”ä¸º 5 ä¸ªä»»åŠ¡æ·»åŠ æ ‡ç­¾"Sprint 3"
    And æ˜¾ç¤º"å·²ä¸º 5 ä¸ªä»»åŠ¡æ·»åŠ æ ‡ç­¾"
    And ä»»åŠ¡åˆ—è¡¨åº”æ˜¾ç¤ºæ ‡ç­¾ç­›é€‰ï¼šSprint 3 (5)
```

---

## 6. æŒ‡æ ‡ä¸è¿½è¸ª

### äº‹ä»¶åŸ‹ç‚¹

```typescript
// æ‰¹é‡æ“ä½œ
{
  event: 'tasks_batch_operation',
  properties: {
    operation: 'mark_completed' | 'delete' | 'add_tag' | 'set_priority',
    taskCount: number,
    duration: number  // æ“ä½œè€—æ—¶ï¼ˆmsï¼‰
  }
}

// é…ç½®ä¾èµ–å…³ç³»
{
  event: 'task_dependency_added',
  properties: {
    taskUuid: string,
    dependsOnTaskUuid: string,
    dependencyType: DependencyType
  }
}

// æŸ¥çœ‹ä¾èµ–å›¾
{
  event: 'dependency_graph_viewed',
  properties: {
    taskCount: number,
    dependencyCount: number,
    hasCriticalPath: boolean
  }
}

// æ£€æµ‹å¾ªç¯ä¾èµ–
{
  event: 'circular_dependency_detected',
  properties: {
    circularPath: string[],
    blockedOperation: string
  }
}
```

---

### æˆåŠŸæŒ‡æ ‡

**å®šé‡æŒ‡æ ‡**:
| æŒ‡æ ‡ | ç›®æ ‡å€¼ | æµ‹é‡æ–¹å¼ |
|------|-------|---------|
| æ‰¹é‡æ“ä½œä½¿ç”¨ç‡ | >40% | ä½¿ç”¨æ‰¹é‡æ“ä½œçš„ç”¨æˆ·æ•° / æ€»ç”¨æˆ·æ•° |
| ä¾èµ–å›¾æŸ¥çœ‹ç‡ | >20% | æŸ¥çœ‹ä¾èµ–å›¾çš„æ¬¡æ•° / ä»»åŠ¡æŸ¥çœ‹æ¬¡æ•° |
| å¾ªç¯ä¾èµ–æ£€æµ‹æˆåŠŸç‡ | 100% | é˜»æ­¢çš„å¾ªç¯ä¾èµ–æ•° / å°è¯•åˆ›å»ºæ•° |
| æ‰¹é‡æ“ä½œå¹³å‡æ—¶é—´èŠ‚çœ | >50% | (å•ä¸ªæ“ä½œæ—¶é—´ Ã— æ•°é‡) vs æ‰¹é‡æ“ä½œæ—¶é—´ |

**å®šæ€§æŒ‡æ ‡**:
- ç”¨æˆ·åé¦ˆ"å¤šä»»åŠ¡ç®¡ç†æ•ˆç‡æå‡"
- ä»»åŠ¡ä¾èµ–å…³ç³»æ›´æ¸…æ™°
- é˜»å¡ä»»åŠ¡è¯†åˆ«æ›´åŠæ—¶

---

## 7. æŠ€æœ¯å®ç°è¦ç‚¹

### Prisma Schema

```prisma
model Task {
  // ...existing fields...
  
  isBlocked            Boolean  @default(false) @map("is_blocked")
  blockingReason       String?  @map("blocking_reason")
  dependencyStatus     String   @default("none") @map("dependency_status")
  
  dependencies         TaskDependency[] @relation("TaskDependencies")
  dependents           TaskDependency[] @relation("DependentTasks")
}

model TaskDependency {
  uuid                 String   @id @default(uuid())
  taskUuid             String   @map("task_uuid")
  dependsOnTaskUuid    String   @map("depends_on_task_uuid")
  dependencyType       String   @map("dependency_type")
  status               String   @default("active")
  createdAt            DateTime @default(now()) @map("created_at")
  createdBy            String   @map("created_by")
  
  task                 Task     @relation("TaskDependencies", fields: [taskUuid], references: [uuid])
  dependsOnTask        Task     @relation("DependentTasks", fields: [dependsOnTaskUuid], references: [uuid])
  
  @@unique([taskUuid, dependsOnTaskUuid])
  @@index([taskUuid])
  @@index([dependsOnTaskUuid])
  @@map("task_dependencies")
}
```

### å¾ªç¯ä¾èµ–æ£€æµ‹ç®—æ³•

```typescript
// packages/domain-server/src/modules/task/services/DependencyGraphService.ts

export class DependencyGraphService {
  /**
   * æ£€æµ‹å¾ªç¯ä¾èµ–ï¼ˆæ‹“æ‰‘æ’åºï¼‰
   */
  detectCircularDependency(
    taskUuid: string,
    newDependencyUuid: string,
    allDependencies: TaskDependency[]
  ): string[] | null {
    // æ„å»ºé‚»æ¥è¡¨
    const graph = this.buildAdjacencyList(allDependencies);
    graph[taskUuid] = graph[taskUuid] || [];
    graph[taskUuid].push(newDependencyUuid);
    
    // DFS æ£€æµ‹å¾ªç¯
    const visited = new Set<string>();
    const recStack = new Set<string>();
    const path: string[] = [];
    
    const dfs = (node: string): boolean => {
      visited.add(node);
      recStack.add(node);
      path.push(node);
      
      for (const neighbor of (graph[node] || [])) {
        if (!visited.has(neighbor)) {
          if (dfs(neighbor)) return true;
        } else if (recStack.has(neighbor)) {
          path.push(neighbor);
          return true; // æ‰¾åˆ°å¾ªç¯
        }
      }
      
      recStack.delete(node);
      path.pop();
      return false;
    };
    
    if (dfs(taskUuid)) {
      return path; // è¿”å›å¾ªç¯è·¯å¾„
    }
    return null;
  }
}
```

### API ç«¯ç‚¹

```typescript
// æ‰¹é‡æ“ä½œ
POST /api/v1/tasks/batch/update
Body: { taskUuids: string[], updates: Partial<TaskServerDTO> }
Response: { updatedCount: number }

// æ·»åŠ ä¾èµ–
POST /api/v1/tasks/:id/dependencies
Body: { dependsOnTaskUuid: string, dependencyType: DependencyType }
Response: TaskClientDTO

// è·å–ä¾èµ–å›¾æ•°æ®
GET /api/v1/tasks/dependency-graph
Query: taskUuids?: string[]
Response: { nodes: TaskNode[], edges: TaskEdge[] }

// æ£€æµ‹å¾ªç¯ä¾èµ–
POST /api/v1/tasks/dependency-graph/validate
Body: { taskUuid: string, newDependencyUuid: string }
Response: { isValid: boolean, circularPath?: string[] }
```

---

## 8. é£é™©ä¸ç¼“è§£

| é£é™© | å¯èƒ½æ€§ | å½±å“ | ç¼“è§£æªæ–½ |
|------|-------|------|---------|
| æ‰¹é‡æ“ä½œè¯¯åˆ ä»»åŠ¡ | ä¸­ | é«˜ | äºŒæ¬¡ç¡®è®¤ + 30 ç§’æ’¤é”€ + è½¯åˆ é™¤ |
| ä¾èµ–å›¾æ¸²æŸ“æ€§èƒ½é—®é¢˜ | ä¸­ | ä¸­ | è™šæ‹ŸåŒ–æ¸²æŸ“ + åˆ†é¡µåŠ è½½ + ç¼“å­˜ |
| å¾ªç¯ä¾èµ–æ£€æµ‹å¤±è´¥ | ä½ | é«˜ | å•å…ƒæµ‹è¯• + å‰åç«¯åŒé‡æ ¡éªŒ |
| ä¾èµ–å…³ç³»å¤æ‚æ—¶ç”¨æˆ·å›°æƒ‘ | ä¸­ | ä¸­ | å…³é”®è·¯å¾„é«˜äº® + åˆ†å±‚å¸ƒå±€ + æ•™ç¨‹ |

---

## 9. å‚è€ƒèµ„æ–™

- [Task Contracts](../../../../packages/contracts/src/modules/task/)
- [React Flow æ–‡æ¡£](https://reactflow.dev/)
- [æ‹“æ‰‘æ’åºç®—æ³•](https://en.wikipedia.org/wiki/Topological_sorting)
- [å…³é”®è·¯å¾„æ³•ï¼ˆCPMï¼‰](https://en.wikipedia.org/wiki/Critical_path_method)

---

**æ–‡æ¡£çŠ¶æ€**: âœ… Ready for PM Review  
**ä¸‹ä¸€æ­¥**: PM ç”Ÿæˆ Project Flow
