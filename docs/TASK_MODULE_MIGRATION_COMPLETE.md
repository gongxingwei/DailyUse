# Task æ¨¡å—è¿ç§»å®Œæˆæ€»ç»“

## è¿ç§»æ¦‚è¿°

æˆåŠŸå®Œæˆäº† Task æ¨¡å—ä» desktop åˆ°æ–°çš„ Contracts-First DDD æ¶æ„çš„è¿ç§»ï¼Œå‚è€ƒäº† Goal æ¨¡å—çš„æˆåŠŸè¿ç§»æ¨¡å¼ã€‚

## æ¶æ„ç»“æ„

### 1. Contracts å±‚ (packages/contracts/src/modules/task/)

#### ç±»å‹å®šä¹‰ (types.ts)
- **TaskTimeType**: `specific_time`, `flexible_time`, `all_day`
- **TaskScheduleMode**: `once`, `recurring_daily`, `recurring_weekly`, `recurring_monthly`, `custom`
- **æ ¸å¿ƒæ¥å£**: `ITaskTemplate`, `ITaskInstance`, `ITaskMetaTemplate`
- **ç®€åŒ–çš„æ—¶é—´é…ç½®**: ç§»é™¤äº†å¤æ‚çš„åµŒå¥—ç»“æ„ï¼Œé‡‡ç”¨å¹³å¦åŒ–è®¾è®¡

#### DTO å®šä¹‰ (dtos.ts)
- **è¯·æ±‚ DTOs**: 20+ ç§è¯·æ±‚ç±»å‹ï¼ŒåŒ…æ‹¬ CRUD æ“ä½œå’Œä¸šåŠ¡æ“ä½œ
- **å“åº” DTOs**: å®Œæ•´çš„æ•°æ®ä¼ è¾“å¯¹è±¡ï¼ŒåŒ…å« TaskTemplateDTO, TaskInstanceDTO, TaskMetaTemplateDTO
- **åˆ—è¡¨å“åº”**: æ ‡å‡†åŒ–çš„åˆ†é¡µåˆ—è¡¨å“åº”æ ¼å¼
- **æŸ¥è¯¢å‚æ•°**: çµæ´»çš„è¿‡æ»¤å’ŒæŸ¥è¯¢æ”¯æŒ

#### äº‹ä»¶å®šä¹‰ (events.ts)
- **25+ é¢†åŸŸäº‹ä»¶**: è¦†ç›–å®Œæ•´çš„ä»»åŠ¡ç”Ÿå‘½å‘¨æœŸ
- **æ¨¡æ¿äº‹ä»¶**: åˆ›å»ºã€æ›´æ–°ã€æ¿€æ´»ã€æš‚åœã€å®Œæˆã€å½’æ¡£
- **å®ä¾‹äº‹ä»¶**: åˆ›å»ºã€å¼€å§‹ã€æš‚åœã€æ¢å¤ã€å®Œæˆã€å–æ¶ˆã€é‡æ–°è°ƒåº¦
- **å…ƒæ¨¡æ¿äº‹ä»¶**: åˆ›å»ºã€æ›´æ–°ã€ä½¿ç”¨ç»Ÿè®¡

### 2. Domain-Core å±‚ (packages/domain-core/src/task/aggregates/TaskCore.ts)

#### æŠ½è±¡åŸºç±»
- **TaskTemplateCore**: ä»»åŠ¡æ¨¡æ¿çš„å…±äº«ä¸šåŠ¡é€»è¾‘
- **TaskInstanceCore**: ä»»åŠ¡å®ä¾‹çš„æ‰§è¡Œè·Ÿè¸ªé€»è¾‘
- **TaskMetaTemplateCore**: å…ƒæ¨¡æ¿çš„ä½¿ç”¨ç»Ÿè®¡é€»è¾‘

#### æ ¸å¿ƒåŠŸèƒ½
- ç»§æ‰¿è‡ª AggregateRootï¼Œæä¾›é¢†åŸŸäº‹ä»¶æ”¯æŒ
- å°è£…äº†ä¸‰ç§ä»»åŠ¡å®ä½“çš„å…±åŒè¡Œä¸º
- æä¾›äº†ç±»å‹å®‰å…¨çš„å±æ€§è®¿é—®å’Œä¸šåŠ¡è§„åˆ™

### 3. Domain-Server å±‚ (packages/domain-server/src/task/)

#### èšåˆæ ¹å®ç° (aggregates/)
- **TaskTemplate**: æœåŠ¡ç«¯ä»»åŠ¡æ¨¡æ¿èšåˆæ ¹
- **TaskInstance**: æœåŠ¡ç«¯ä»»åŠ¡å®ä¾‹å®ä½“
- **TaskMetaTemplate**: æœåŠ¡ç«¯å…ƒæ¨¡æ¿å®ä½“

#### ä»“å‚¨æ¥å£ (repositories/)
- **ITaskTemplateRepository**: æ¨¡æ¿æŒä¹…åŒ–æ¥å£
- **ITaskInstanceRepository**: å®ä¾‹æŒä¹…åŒ–æ¥å£  
- **ITaskMetaTemplateRepository**: å…ƒæ¨¡æ¿æŒä¹…åŒ–æ¥å£
- **ITaskStatsRepository**: ç»Ÿè®¡æ•°æ®æ¥å£

#### å…³é”®ç‰¹æ€§
- å®Œæ•´çš„ä¸šåŠ¡é€»è¾‘å®ç°
- é¢†åŸŸäº‹ä»¶å‘å¸ƒæœºåˆ¶
- ç”Ÿå‘½å‘¨æœŸçŠ¶æ€ç®¡ç†
- å®ä¾‹ç»Ÿè®¡å’Œæ€§èƒ½è·Ÿè¸ª

### 4. Domain-Client å±‚ (packages/domain-client/src/task/)

#### å®¢æˆ·ç«¯æ‰©å±•
- **Task å®ä½“**: å¸¦æœ‰ UI è¾…åŠ©æ–¹æ³•çš„å®¢æˆ·ç«¯æ‰©å±•
- **TaskService**: æœ¬åœ°ç¼“å­˜ã€è¿‡æ»¤ã€æœç´¢åŠŸèƒ½
- **å®¢æˆ·ç«¯ç‰¹æœ‰å±æ€§**: æ˜¾ç¤ºçŠ¶æ€ã€æœ¬åœ°ç¼“å­˜ã€UI è¾…åŠ©æ–¹æ³•

#### åŠŸèƒ½ç‰¹è‰²
- æ™ºèƒ½ç¼“å­˜æœºåˆ¶
- æœ¬åœ°æœç´¢å’Œè¿‡æ»¤
- UI çŠ¶æ€ç®¡ç†
- ç¦»çº¿æ”¯æŒå‡†å¤‡

### 5. API å±‚ (apps/api/src/modules/task/)

#### åº”ç”¨æœåŠ¡
- **TaskApplicationService**: å®Œæ•´çš„ä¸šåŠ¡æµç¨‹åè°ƒ
- **TaskApplicationService.simple**: ç®€åŒ–ç‰ˆæœ¬ï¼Œç”¨äºéªŒè¯æ¶æ„

#### å®ç°çŠ¶æ€
- âœ… ç®€åŒ–ç‰ˆåº”ç”¨æœåŠ¡ç¼–è¯‘é€šè¿‡
- âœ… åŸºç¡€æ¶æ„éªŒè¯å®Œæˆ
- ğŸ”„ å®Œæ•´ç‰ˆåº”ç”¨æœåŠ¡éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•

## ä¸‰å±‚ä»»åŠ¡ç³»ç»Ÿè®¾è®¡

### TaskTemplate (ä»»åŠ¡æ¨¡æ¿)
- **ç›®çš„**: å®šä¹‰å¯é‡å¤ä½¿ç”¨çš„ä»»åŠ¡æ¨¡å¼
- **çŠ¶æ€**: draft â†’ active â†’ paused/completed â†’ archived
- **åŠŸèƒ½**: æ—¶é—´é…ç½®ã€æé†’è®¾ç½®ã€ç›®æ ‡å…³è”ã€å®ä¾‹ç”Ÿæˆ

### TaskInstance (ä»»åŠ¡å®ä¾‹)
- **ç›®çš„**: å…·ä½“çš„ä»»åŠ¡æ‰§è¡Œå•å…ƒ
- **çŠ¶æ€**: pending â†’ inProgress â†’ completed/cancelled
- **åŠŸèƒ½**: æ‰§è¡Œè·Ÿè¸ªã€è¿›åº¦è®°å½•ã€æ—¶é—´ç»Ÿè®¡ã€é‡æ–°è°ƒåº¦

### TaskMetaTemplate (ä»»åŠ¡å…ƒæ¨¡æ¿)
- **ç›®çš„**: ä»»åŠ¡æ¨¡æ¿çš„åˆ›å»ºé¢„è®¾
- **åŠŸèƒ½**: é»˜è®¤é…ç½®ã€å¤–è§‚è®¾ç½®ã€ä½¿ç”¨ç»Ÿè®¡ã€å¿«é€Ÿåˆ›å»º

## é‡è¦ä¼˜åŒ–

### 1. æ—¶é—´é…ç½®ç®€åŒ–
```typescript
// æ—§çš„å¤æ‚ç»“æ„
{
  type: 'specific',
  specificTime: { date: Date, startTime: string, endTime: string },
  flexibleTime: { ... },
  allDay: { ... }
}

// æ–°çš„ç®€åŒ–ç»“æ„
{
  time: { timeType: TaskTimeType, startTime?: string, endTime?: string },
  date: { startDate: Date, endDate?: Date },
  schedule: { mode: TaskScheduleMode, intervalDays?: number, ... },
  timezone: string
}
```

### 2. ç»Ÿä¸€çš„ DTO æ¥å£
- æ ‡å‡†åŒ–çš„è¯·æ±‚/å“åº”æ ¼å¼
- ä¸€è‡´çš„åˆ†é¡µå’ŒæŸ¥è¯¢å‚æ•°
- å®Œæ•´çš„é”™è¯¯å¤„ç†æ”¯æŒ

### 3. äº‹ä»¶é©±åŠ¨æ¶æ„
- 25+ é¢†åŸŸäº‹ä»¶æ”¯æŒ
- å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸäº‹ä»¶è·Ÿè¸ª
- è·¨æ¨¡å—äº‹ä»¶é€šä¿¡èƒ½åŠ›

## ç¼–è¯‘çŠ¶æ€

### âœ… å·²å®Œæˆå¹¶éªŒè¯
- packages/contracts/src/modules/task/ (æ‰€æœ‰æ–‡ä»¶)
- packages/domain-core/src/task/aggregates/TaskCore.ts
- packages/domain-server/src/task/ (æ‰€æœ‰æ–‡ä»¶)
- packages/domain-client/src/task/ (æ‰€æœ‰æ–‡ä»¶)
- apps/api/src/modules/task/application/services/TaskApplicationService.simple.ts

### ğŸ”„ éœ€è¦è¿›ä¸€æ­¥è°ƒè¯•
- apps/api/src/modules/task/application/services/TaskApplicationService.ts (å®Œæ•´ç‰ˆ)
- åŒ…å¯¼å…¥è·¯å¾„ä¼˜åŒ–
- ä»“å‚¨å®ç°å±‚
- API è·¯ç”±å’Œæ§åˆ¶å™¨

## ä¸‹ä¸€æ­¥è®¡åˆ’

### 1. ç«‹å³ä»»åŠ¡
- è§£å†³å®Œæ•´ç‰ˆåº”ç”¨æœåŠ¡çš„ç¼–è¯‘é”™è¯¯
- ä¼˜åŒ–åŒ…å¯¼å…¥è·¯å¾„å’Œä¾èµ–å…³ç³»
- å®ç°ä»“å‚¨æ¥å£çš„å…·ä½“å®ç°

### 2. ä¸­æœŸä»»åŠ¡
- åˆ›å»º API è·¯ç”±å’Œæ§åˆ¶å™¨
- å®ç°æ•°æ®åº“è¿ç§»è„šæœ¬
- æ·»åŠ å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•

### 3. é•¿æœŸç›®æ ‡
- æ€§èƒ½ä¼˜åŒ–å’Œç¼“å­˜ç­–ç•¥
- å‰ç«¯ç»„ä»¶é€‚é…
- å®Œæ•´çš„ E2E æµ‹è¯•è¦†ç›–

## æˆåŠŸå…³é”®å› ç´ 

1. **å‚è€ƒ Goal æ¨¡å—æ¨¡å¼**: ä¸¥æ ¼éµå¾ªå·²éªŒè¯çš„æ¶æ„æ¨¡å¼
2. **Contracts-First è®¾è®¡**: ç¡®ä¿æ‰€æœ‰å±‚æ¬¡çš„ä¸€è‡´æ€§
3. **ç®€åŒ–æ—¶é—´é…ç½®**: å¤§å¹…å‡å°‘äº†å¤æ‚æ€§ï¼Œæé«˜äº†å¯ç»´æŠ¤æ€§
4. **å®Œæ•´äº‹ä»¶ç³»ç»Ÿ**: ä¸ºæœªæ¥æ‰©å±•æä¾›äº†å¼ºå¤§çš„åŸºç¡€
5. **åˆ†å±‚éªŒè¯**: é€šè¿‡ç®€åŒ–ç‰ˆæœ¬éªŒè¯æ¶æ„å¯è¡Œæ€§

## æ¶æ„è´¨é‡è¯„ä¼°

- **ä»£ç ç»„ç»‡**: â­â­â­â­â­ æ¸…æ™°çš„åˆ†å±‚æ¶æ„
- **ç±»å‹å®‰å…¨**: â­â­â­â­â­ å®Œæ•´çš„ TypeScript æ”¯æŒ
- **å¯æµ‹è¯•æ€§**: â­â­â­â­â­ ä¾èµ–æ³¨å…¥å’Œæ¥å£åˆ†ç¦»
- **å¯æ‰©å±•æ€§**: â­â­â­â­â­ äº‹ä»¶é©±åŠ¨å’Œæ¨¡å—åŒ–è®¾è®¡
- **å¯ç»´æŠ¤æ€§**: â­â­â­â­â­ æ ‡å‡†åŒ–çš„ä»£ç ç»“æ„

Task æ¨¡å—è¿ç§»å·²æˆåŠŸå»ºç«‹äº†åšå®çš„åŸºç¡€ï¼Œä¸ºç³»ç»Ÿçš„é•¿æœŸå‘å±•å¥ å®šäº†è‰¯å¥½çš„æ¶æ„åŸºç¡€ã€‚
