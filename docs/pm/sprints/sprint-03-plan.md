# Sprint 3 è¯¦ç»†æ‰§è¡Œè®¡åˆ’

> **Sprint ID**: Sprint 3  
> **Sprint å‘¨æœŸ**: Week 7-8 (2025-12-01 ~ 2025-12-12)  
> **Sprint ç›®æ ‡**: å®ç°ç›®æ ‡è¿›åº¦è‡ªåŠ¨è®¡ç®— + ä»»åŠ¡ä¼˜å…ˆçº§çŸ©é˜µ  
> **Story Points**: 30 SP  
> **Epics**: GOAL-004 + TASK-002  
> **çŠ¶æ€**: Planning  
> **ä¾èµ–**: Sprint 2a/2b (Goal æ¨¡å—åŸºç¡€æ¶æ„)

---

## ğŸ“‹ Sprint æ¦‚è§ˆ

### Sprint ç›®æ ‡ (Sprint Goal)

> **å®ç°ç›®æ ‡è¿›åº¦çš„è‡ªåŠ¨è®¡ç®—èƒ½åŠ›å’Œä»»åŠ¡ä¼˜å…ˆçº§çš„ç§‘å­¦ç®¡ç†ï¼Œæå‡æ•°æ®å‡†ç¡®æ€§å’Œä»»åŠ¡æ‰§è¡Œæ•ˆç‡ã€‚**

**æ ¸å¿ƒä»·å€¼**:
- âœ… ç›®æ ‡è¿›åº¦æ ¹æ® KR æƒé‡è‡ªåŠ¨è®¡ç®—ï¼Œæ¶ˆé™¤æ‰‹åŠ¨æ›´æ–°
- âœ… åŸºäºè‰¾æ£®è±ªå¨å°”çŸ©é˜µï¼ˆé‡è¦æ€§Ã—ç´§æ€¥åº¦ï¼‰ç®¡ç†ä»»åŠ¡ä¼˜å…ˆçº§
- âœ… æä¾›å››è±¡é™çŸ©é˜µå¯è§†åŒ–ï¼Œå¸®åŠ©ç”¨æˆ·ç§‘å­¦å†³ç­–
- âœ… æ™ºèƒ½æ’åºåŠŸèƒ½ï¼Œè‡ªåŠ¨æŒ‰ä¼˜å…ˆçº§é‡æ’ä»»åŠ¡åˆ—è¡¨

### Epic èƒŒæ™¯

**GOAL-004 - ç›®æ ‡è¿›åº¦è‡ªåŠ¨è®¡ç®—**:
- **ä¸šåŠ¡ä»·å€¼**: æ ¹æ® KR å®Œæˆæƒ…å†µå’Œæƒé‡è‡ªåŠ¨è®¡ç®—ç›®æ ‡è¿›åº¦ï¼Œç¡®ä¿æ•°æ®å®æ—¶å‡†ç¡®
- **æ ¸å¿ƒç®—æ³•**: åŠ æƒå¹³å‡ `progress = Î£(KR.progress Ã— KR.weight) / Î£(KR.weight)`
- **ç”¨æˆ·åœºæ™¯**: ç”¨æˆ·æ›´æ–° KR è¿›åº¦åï¼Œç›®æ ‡è¿›åº¦è‡ªåŠ¨æ›´æ–°ï¼›è°ƒæ•´ KR æƒé‡åï¼Œç›®æ ‡è¿›åº¦è‡ªåŠ¨é‡ç®—

**TASK-002 - ä»»åŠ¡ä¼˜å…ˆçº§çŸ©é˜µ**:
- **ä¸šåŠ¡ä»·å€¼**: åŸºäºè‰¾æ£®è±ªå¨å°”çŸ©é˜µè‡ªåŠ¨è®¡ç®—ä»»åŠ¡ä¼˜å…ˆçº§ï¼Œç§‘å­¦å†³ç­–"å…ˆåšä»€ä¹ˆ"
- **æ ¸å¿ƒç®—æ³•**: ä¼˜å…ˆçº§åˆ†æ•° = é‡è¦æ€§(1-5) Ã— ç´§æ€¥åº¦(1-5)
- **ç”¨æˆ·åœºæ™¯**: ç”¨æˆ·è®¾ç½®ä»»åŠ¡é‡è¦æ€§å’Œç´§æ€¥åº¦ï¼Œç³»ç»Ÿè‡ªåŠ¨è®¡ç®—ä¼˜å…ˆçº§å¹¶åˆ†é…åˆ°å››è±¡é™

---

## ğŸ“… æ¯æ—¥æ‰§è¡Œè®¡åˆ’ (Day-by-Day Plan)

### **Week 7: ç›®æ ‡è¿›åº¦è‡ªåŠ¨è®¡ç®— (GOAL-004)**

#### **Day 1 (2025-12-01 å‘¨ä¸€): Contracts & Domain å±‚**

**ç›®æ ‡**: å®Œæˆ GOAL-004 Story-001 (3 SP)

**ä»»åŠ¡æ¸…å•**:
- [ ] **09:00-09:15** Sprint 3 Kickoff ä¼šè®®
  - Review Sprint 2a/2b æˆæœ
  - Review Sprint 3 ç›®æ ‡å’Œ Story åˆ—è¡¨
  - ç¡®è®¤æŠ€æœ¯æ ˆå’Œåˆ†å·¥

- [ ] **09:30-12:00** å¼€å‘ Contracts å±‚ (2.5h)
  - åˆ›å»ºè¿›åº¦è®¡ç®—ç›¸å…³ DTO:
    ```typescript
    // packages/contracts/src/goal/ProgressCalculationMode.ts
    export enum ProgressCalculationMode {
      WEIGHTED_AVERAGE = 'weighted_average',  // åŠ æƒå¹³å‡ï¼ˆé»˜è®¤ï¼‰
      MIN_VALUE = 'min_value',                // æœ€å°å€¼
      THRESHOLD = 'threshold',                // é˜ˆå€¼æ¨¡å¼
      CUSTOM = 'custom'                       // è‡ªå®šä¹‰
    }
    
    // packages/contracts/src/goal/ProgressBreakdown.ts
    export interface ProgressBreakdown {
      totalProgress: number;
      calculationMode: ProgressCalculationMode;
      krContributions: Array<{
        keyResultUuid: string;
        keyResultName: string;
        progress: number;
        weight: number;
        contribution: number;  // progress Ã— weight
      }>;
      calculationFormula: string;
      updatedAt: number;
    }
    
    // packages/contracts/src/goal/ProgressOverride.ts
    export interface ProgressOverride {
      isOverridden: boolean;
      manualProgress: number;
      overrideReason: string;
      autoRestore: boolean;
      overrideTime: number;
      operatorUuid: string;
    }
    ```
  - æ›´æ–° `GoalServerDTO` æ·»åŠ è¿›åº¦ç›¸å…³å­—æ®µ

- [ ] **13:00-15:00** å¼€å‘ Domain å±‚ (2h)
  - æ›´æ–° `Goal` èšåˆæ ¹æ·»åŠ è¿›åº¦è®¡ç®—æ–¹æ³•:
    ```typescript
    export class Goal extends AggregateRoot {
      private _progress: number = 0;
      private _progressCalculationMode = ProgressCalculationMode.WEIGHTED_AVERAGE;
      private _progressOverride?: ProgressOverride;
      
      /**
       * è‡ªåŠ¨è®¡ç®—ç›®æ ‡è¿›åº¦ï¼ˆåŠ æƒå¹³å‡ç®—æ³•ï¼‰
       */
      calculateProgress(): void {
        if (this._progressOverride?.isOverridden && !this.shouldAutoRestore()) {
          return;
        }
        
        const newProgress = this.calculateWeightedAverage();
        
        if (newProgress !== this._progress) {
          const oldProgress = this._progress;
          this._progress = newProgress;
          
          this.addDomainEvent(new GoalProgressUpdatedEvent({
            goalUuid: this.uuid,
            oldProgress,
            newProgress,
            trigger: 'kr_update'
          }));
        }
      }
      
      private calculateWeightedAverage(): number {
        if (this.keyResults.length === 0) return 0;
        
        const totalWeight = this.keyResults.reduce((sum, kr) => sum + kr.weight, 0);
        if (totalWeight === 0) return 0;
        
        const weightedSum = this.keyResults.reduce(
          (sum, kr) => sum + (kr.progress * kr.weight / 100),
          0
        );
        
        return Math.round((weightedSum / totalWeight) * 100);
      }
      
      getProgressBreakdown(): ProgressBreakdown {
        // è¿”å›è¿›åº¦åˆ†è§£è¯¦æƒ…
      }
      
      overrideProgress(manual: number, reason: string, operator: string): void {
        // æ‰‹åŠ¨è¦†ç›–è¿›åº¦
      }
    }
    ```

- [ ] **15:00-17:00** ç¼–å†™å•å…ƒæµ‹è¯• (2h)
  - æµ‹è¯•åŠ æƒå¹³å‡ç®—æ³•
  - æµ‹è¯•è¿›åº¦åˆ†è§£è®¡ç®—
  - æµ‹è¯•æ‰‹åŠ¨è¦†ç›–é€»è¾‘
  - ç›®æ ‡è¦†ç›–ç‡: â‰¥ 80%

- [ ] **17:00-17:30** Code Review & æäº¤
  - PR: `feat(goal): add progress auto-calculation contracts and domain`

**äº¤ä»˜ç‰©**:
- âœ… è¿›åº¦è®¡ç®—ç›¸å…³ Contracts (DTO + æšä¸¾)
- âœ… Goal èšåˆæ ¹çš„è¿›åº¦è®¡ç®—æ–¹æ³•
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

---

#### **Day 2 (2025-12-02 å‘¨äºŒ): Application Service - è¿›åº¦è®¡ç®—æœåŠ¡**

**ç›®æ ‡**: å®Œæˆ GOAL-004 Story-002 (3 SP)

**ä»»åŠ¡æ¸…å•**:
- [ ] **09:00-12:00** åˆ›å»º Application Service (3h)
  - åˆ›å»º `ProgressCalculationApplicationService.ts`:
    ```typescript
    export class ProgressCalculationApplicationService {
      constructor(
        private goalRepository: GoalRepository,
        private eventBus: EventBus
      ) {}
      
      /**
       * é‡æ–°è®¡ç®—ç›®æ ‡è¿›åº¦ï¼ˆç”± KR æ›´æ–°è§¦å‘ï¼‰
       */
      async recalculateGoalProgress(goalUuid: string): Promise<void> {
        const goal = await this.goalRepository.findByUuid(goalUuid);
        if (!goal) throw new GoalNotFoundError();
        
        goal.calculateProgress();
        await this.goalRepository.save(goal);
        
        // å‘å¸ƒè¿›åº¦æ›´æ–°äº‹ä»¶
        this.eventBus.publish(goal.getDomainEvents());
      }
      
      /**
       * æ‰¹é‡é‡ç®—å¤šä¸ªç›®æ ‡
       */
      async recalculateMultipleGoals(goalUuids: string[]): Promise<number> {
        let updatedCount = 0;
        
        for (const uuid of goalUuids) {
          try {
            await this.recalculateGoalProgress(uuid);
            updatedCount++;
          } catch (error) {
            console.error(`é‡ç®—ç›®æ ‡ ${uuid} å¤±è´¥:`, error);
          }
        }
        
        return updatedCount;
      }
      
      /**
       * æ‰‹åŠ¨è¦†ç›–è¿›åº¦
       */
      async overrideProgress(
        goalUuid: string,
        manualProgress: number,
        reason: string,
        operatorUuid: string
      ): Promise<void> {
        const goal = await this.goalRepository.findByUuid(goalUuid);
        if (!goal) throw new GoalNotFoundError();
        
        goal.overrideProgress(manualProgress, reason, operatorUuid);
        await this.goalRepository.save(goal);
      }
      
      /**
       * æ¢å¤è‡ªåŠ¨è®¡ç®—
       */
      async restoreAutoProgress(goalUuid: string): Promise<void> {
        const goal = await this.goalRepository.findByUuid(goalUuid);
        if (!goal) throw new GoalNotFoundError();
        
        goal.restoreAutoProgress();
        goal.calculateProgress();
        await this.goalRepository.save(goal);
      }
    }
    ```

- [ ] **13:00-15:00** é›†æˆäº‹ä»¶ç›‘å¬ (2h)
  - åˆ›å»º `KeyResultProgressUpdatedEventHandler`:
    ```typescript
    export class KeyResultProgressUpdatedEventHandler {
      constructor(
        private progressService: ProgressCalculationApplicationService
      ) {}
      
      async handle(event: KeyResultProgressUpdatedEvent): Promise<void> {
        // KR è¿›åº¦æ›´æ–°æ—¶ï¼Œè‡ªåŠ¨è§¦å‘ç›®æ ‡è¿›åº¦é‡ç®—
        await this.progressService.recalculateGoalProgress(event.goalUuid);
      }
    }
    ```
  - åˆ›å»º `KeyResultWeightChangedEventHandler`ï¼ˆæƒé‡å˜åŒ–ä¹Ÿè§¦å‘é‡ç®—ï¼‰

- [ ] **15:00-17:00** ç¼–å†™é›†æˆæµ‹è¯• (2h)
  - æµ‹è¯•è¿›åº¦è‡ªåŠ¨é‡ç®—
  - æµ‹è¯•äº‹ä»¶é©±åŠ¨æµç¨‹
  - æµ‹è¯•æ‰¹é‡é‡ç®—

- [ ] **17:00-17:30** Code Review & æäº¤
  - PR: `feat(goal): add progress calculation application service`

**äº¤ä»˜ç‰©**:
- âœ… `ProgressCalculationApplicationService` å®Œæ•´å®ç°
- âœ… äº‹ä»¶ç›‘å¬å™¨ï¼ˆè‡ªåŠ¨è§¦å‘é‡ç®—ï¼‰
- âœ… é›†æˆæµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

---

#### **Day 3 (2025-12-03 å‘¨ä¸‰): Infrastructure + API**

**ç›®æ ‡**: å®Œæˆ GOAL-004 Story-003 (2 SP) + Story-004 (2 SP)

**ä»»åŠ¡æ¸…å•**:
- [ ] **09:00-11:00** æ›´æ–° Prisma Schema (2h)
  - æ›´æ–° `Goal` æ¨¡å‹:
    ```prisma
    model Goal {
      // ...existing fields...
      
      progress                    Int       // 0-100
      progressCalculationMode     String    @default("weighted_average")
      progressBreakdown           Json?     // ProgressBreakdown
      progressOverride            Json?     // ProgressOverride
      lastProgressUpdateTime      BigInt
      progressUpdateTrigger       String    @default("manual")
      
      @@map("goals")
    }
    ```
  - è¿è¡Œè¿ç§»: `pnpm nx run api:prisma-migrate-dev --name add_goal_progress_fields`

- [ ] **11:00-13:00** åˆ›å»º API Endpoints (2h)
  - åˆ›å»º `ProgressController.ts`:
    ```typescript
    @Controller('/api/goals')
    export class ProgressController {
      constructor(private progressService: ProgressCalculationApplicationService) {}
      
      @Post('/:goalId/recalculate-progress')
      @UseGuards(AuthGuard, GoalMemberGuard)
      async recalculateProgress(@Param('goalId') goalId: string): Promise<void> {
        await this.progressService.recalculateGoalProgress(goalId);
      }
      
      @Post('/batch-recalculate-progress')
      @UseGuards(AuthGuard)
      async batchRecalculate(@Body() body: { goalUuids: string[] }): Promise<{ count: number }> {
        const count = await this.progressService.recalculateMultipleGoals(body.goalUuids);
        return { count };
      }
      
      @Post('/:goalId/override-progress')
      @UseGuards(AuthGuard, GoalMemberGuard)
      async overrideProgress(
        @Param('goalId') goalId: string,
        @Body() body: { progress: number; reason: string },
        @CurrentUser() user: User
      ): Promise<void> {
        await this.progressService.overrideProgress(
          goalId,
          body.progress,
          body.reason,
          user.uuid
        );
      }
      
      @Post('/:goalId/restore-auto-progress')
      @UseGuards(AuthGuard, GoalMemberGuard)
      async restoreAutoProgress(@Param('goalId') goalId: string): Promise<void> {
        await this.progressService.restoreAutoProgress(goalId);
      }
    }
    ```

- [ ] **14:00-16:00** ç¼–å†™ API æµ‹è¯• (2h)
  - ä½¿ç”¨ Supertest
  - æµ‹è¯•æ‰€æœ‰ç«¯ç‚¹
  - æµ‹è¯•æƒé™æ£€æŸ¥

- [ ] **16:00-17:30** Code Review & é›†æˆæµ‹è¯•
  - PR: `feat(goal): add progress calculation API`

**äº¤ä»˜ç‰©**:
- âœ… Prisma Schema å’Œæ•°æ®åº“è¿ç§»
- âœ… Progress API ç«¯ç‚¹
- âœ… API æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

---

#### **Day 4 (2025-12-04 å‘¨å››): Client Services + UI å‡†å¤‡**

**ç›®æ ‡**: å®Œæˆ GOAL-004 Story-005 (2 SP)

**ä»»åŠ¡æ¸…å•**:
- [ ] **09:00-12:00** åˆ›å»º Client Service (3h)
  - åˆ›å»º `ProgressClientService.ts`:
    ```typescript
    export class ProgressClientService {
      constructor(private httpClient: HttpClient) {}
      
      async recalculateProgress(goalUuid: string): Promise<void> {
        await this.httpClient.post(`/api/goals/${goalUuid}/recalculate-progress`);
      }
      
      async overrideProgress(
        goalUuid: string,
        progress: number,
        reason: string
      ): Promise<void> {
        await this.httpClient.post(`/api/goals/${goalUuid}/override-progress`, {
          progress,
          reason
        });
      }
      
      async restoreAutoProgress(goalUuid: string): Promise<void> {
        await this.httpClient.post(`/api/goals/${goalUuid}/restore-auto-progress`);
      }
    }
    ```

- [ ] **13:00-15:00** é›†æˆ React Query (2h)
  - åˆ›å»º hooks:
    ```typescript
    export function useRecalculateProgress() {
      const queryClient = useQueryClient();
      
      return useMutation({
        mutationFn: (goalUuid: string) =>
          progressService.recalculateProgress(goalUuid),
        onSuccess: () => {
          queryClient.invalidateQueries({ queryKey: ['goals'] });
        }
      });
    }
    ```

- [ ] **15:00-17:00** ç¼–å†™å®¢æˆ·ç«¯æµ‹è¯• (2h)
  - Mock HTTP responses
  - æµ‹è¯• React Query hooks

- [ ] **17:00-17:30** Code Review & æäº¤
  - PR: `feat(goal): add progress client services`

**äº¤ä»˜ç‰©**:
- âœ… `ProgressClientService` å®Œæ•´å®ç°
- âœ… React Query hooks
- âœ… å®¢æˆ·ç«¯æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

---

#### **Day 5 (2025-12-05 å‘¨äº”): UI - è¿›åº¦åˆ†è§£è¯¦æƒ… + Code Review**

**ç›®æ ‡**: å®Œæˆ GOAL-004 Story-006 (3 SP)

**ä»»åŠ¡æ¸…å•**:
- [ ] **09:00-12:00** åˆ›å»ºè¿›åº¦åˆ†è§£ç»„ä»¶ (3h)
  - åˆ›å»º `ProgressBreakdownPanel.vue`:
    ```vue
    <template>
      <el-card class="progress-breakdown">
        <template #header>
          <div class="header">
            <span>è¿›åº¦è¯¦æƒ…</span>
            <el-tag>{{ calculationModeLabel }}</el-tag>
          </div>
        </template>
        
        <div class="total-progress">
          <el-progress
            :percentage="breakdown.totalProgress"
            :color="progressColor"
          />
          <span class="value">{{ breakdown.totalProgress }}%</span>
        </div>
        
        <el-divider />
        
        <div class="kr-contributions">
          <div
            v-for="kr in breakdown.krContributions"
            :key="kr.keyResultUuid"
            class="kr-item"
          >
            <div class="kr-info">
              <span class="kr-name">{{ kr.keyResultName }}</span>
              <span class="kr-weight">(æƒé‡: {{ kr.weight }}%)</span>
            </div>
            <div class="kr-progress">
              <el-progress
                :percentage="kr.progress"
                :stroke-width="8"
                :show-text="false"
              />
              <span class="progress-value">{{ kr.progress }}%</span>
            </div>
            <div class="kr-contribution">
              è´¡çŒ®: {{ kr.contribution }}%
            </div>
          </div>
        </div>
        
        <el-divider />
        
        <div class="calculation-formula">
          <el-icon><InfoFilled /></el-icon>
          <span>{{ breakdown.calculationFormula }}</span>
        </div>
        
        <div class="actions">
          <el-button @click="recalculate">
            <el-icon><Refresh /></el-icon>
            é‡æ–°è®¡ç®—
          </el-button>
          <el-button @click="showOverrideDialog">
            <el-icon><Edit /></el-icon>
            æ‰‹åŠ¨è¦†ç›–
          </el-button>
        </div>
      </el-card>
    </template>
    
    <script setup lang="ts">
    import { computed } from 'vue';
    import { useRecalculateProgress } from '@/hooks/useProgress';
    
    const props = defineProps<{
      goalUuid: string;
      breakdown: ProgressBreakdown;
    }>();
    
    const { mutate: recalculate } = useRecalculateProgress();
    
    const calculationModeLabel = computed(() => {
      const labels = {
        weighted_average: 'åŠ æƒå¹³å‡',
        min_value: 'æœ€å°å€¼',
        threshold: 'é˜ˆå€¼æ¨¡å¼',
        custom: 'è‡ªå®šä¹‰'
      };
      return labels[props.breakdown.calculationMode];
    });
    
    function showOverrideDialog() {
      // æ‰“å¼€æ‰‹åŠ¨è¦†ç›–å¯¹è¯æ¡†
    }
    </script>
    ```

- [ ] **13:00-15:00** Code Review ä¼šè®® (2h)
  - Review Week 7 æ‰€æœ‰ä»£ç 
  - è®¨è®ºæŠ€æœ¯å€ºåŠ¡

- [ ] **15:00-17:00** ä¿®å¤ Review é—®é¢˜ (2h)

- [ ] **17:00-17:30** å‘¨æ€»ç»“
  - GOAL-004 å®Œæˆåº¦: é¢„è®¡ 100%

**äº¤ä»˜ç‰©**:
- âœ… `ProgressBreakdownPanel.vue` ç»„ä»¶
- âœ… Week 7 Code Review å®Œæˆ
- âœ… GOAL-004 (15 SP) åŸºæœ¬å®Œæˆ

---

### **Week 8: ä»»åŠ¡ä¼˜å…ˆçº§çŸ©é˜µ (TASK-002)**

#### **Day 6 (2025-12-08 å‘¨ä¸€): Contracts & Domain + Application**

**ç›®æ ‡**: å®Œæˆ TASK-002 Story-001 (2 SP) + Story-002 (3 SP)

**ä»»åŠ¡æ¸…å•**:
- [ ] **09:00-11:00** Contracts & Domain å±‚ (2h)
  - æ›´æ–° `TaskServerDTO`:
    ```typescript
    export interface TaskServerDTO {
      // ...existing fields...
      importance: number;        // 1-5
      urgency: number;           // 1-5
      priorityScore: number;     // importance Ã— urgency (1-25)
      autoAdjustEnabled: boolean;
    }
    ```
  - æ›´æ–° `Task` èšåˆæ ¹:
    ```typescript
    export class Task extends AggregateRoot {
      private _importance: number = 3;
      private _urgency: number = 3;
      private _priorityScore: number = 9;
      
      setPriority(importance: number, urgency: number): void {
        this.validatePriority(importance, urgency);
        
        const oldScore = this._priorityScore;
        this._importance = importance;
        this._urgency = urgency;
        this._priorityScore = importance * urgency;
        
        if (oldScore !== this._priorityScore) {
          this.addDomainEvent(new TaskPriorityChangedEvent({
            taskUuid: this.uuid,
            oldScore,
            newScore: this._priorityScore
          }));
        }
      }
      
      getQuadrant(): 'Q1' | 'Q2' | 'Q3' | 'Q4' {
        if (this._importance >= 4 && this._urgency >= 4) return 'Q1';  // é‡è¦ä¸”ç´§æ€¥
        if (this._importance >= 4 && this._urgency < 4) return 'Q2';   // é‡è¦ä¸ç´§æ€¥
        if (this._importance < 4 && this._urgency >= 4) return 'Q3';   // ç´§æ€¥ä¸é‡è¦
        return 'Q4';  // ä¸é‡è¦ä¸ç´§æ€¥
      }
    }
    ```

- [ ] **11:00-13:00** Application Service (2h)
  - åˆ›å»º `TaskPriorityService.ts`:
    ```typescript
    export class TaskPriorityService {
      constructor(private taskRepository: TaskRepository) {}
      
      /**
       * æ™ºèƒ½æ’åºï¼ˆæŒ‰ä¼˜å…ˆçº§åˆ†æ•° + æˆªæ­¢æ—¥æœŸ + åˆ›å»ºæ—¶é—´ï¼‰
       */
      async smartSort(taskUuids: string[]): Promise<Task[]> {
        const tasks = await this.taskRepository.findByUuids(taskUuids);
        
        const sorted = tasks.sort((a, b) => {
          // 1. ä¼˜å…ˆçº§åˆ†æ•°é™åº
          if (a.priorityScore !== b.priorityScore) {
            return b.priorityScore - a.priorityScore;
          }
          // 2. æˆªæ­¢æ—¥æœŸå‡åºï¼ˆè¶Šè¿‘è¶Šä¼˜å…ˆï¼‰
          if (a.dueDate && b.dueDate) {
            return a.dueDate - b.dueDate;
          }
          if (a.dueDate) return -1;
          if (b.dueDate) return 1;
          // 3. åˆ›å»ºæ—¶é—´å‡åº
          return a.createdAt - b.createdAt;
        });
        
        // æ›´æ–° orderIndex
        sorted.forEach((task, index) => {
          task.setOrderIndex(index + 1);
        });
        
        await this.taskRepository.saveAll(sorted);
        
        return sorted;
      }
      
      /**
       * æ‰¹é‡è®¾ç½®ä¼˜å…ˆçº§
       */
      async batchSetPriority(
        taskUuids: string[],
        importance?: number,
        urgency?: number
      ): Promise<number> {
        const tasks = await this.taskRepository.findByUuids(taskUuids);
        
        tasks.forEach(task => {
          const newImportance = importance ?? task.importance;
          const newUrgency = urgency ?? task.urgency;
          task.setPriority(newImportance, newUrgency);
        });
        
        await this.taskRepository.saveAll(tasks);
        
        return tasks.length;
      }
      
      /**
       * æŒ‰è±¡é™è·å–ä»»åŠ¡
       */
      async getTasksByQuadrant(
        quadrant: 'Q1' | 'Q2' | 'Q3' | 'Q4'
      ): Promise<Task[]> {
        const allTasks = await this.taskRepository.findAll();
        return allTasks.filter(task => task.getQuadrant() === quadrant);
      }
    }
    ```

- [ ] **14:00-17:00** ç¼–å†™æµ‹è¯• + Code Review (3h)
  - å•å…ƒæµ‹è¯•
  - é›†æˆæµ‹è¯•
  - PR: `feat(task): add priority matrix contracts, domain and service`

**äº¤ä»˜ç‰©**:
- âœ… ä¼˜å…ˆçº§ç›¸å…³ Contracts å’Œ Domain å®ä½“
- âœ… `TaskPriorityService` å®Œæ•´å®ç°
- âœ… æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

---

#### **Day 7 (2025-12-09 å‘¨äºŒ): Infrastructure + API**

**ç›®æ ‡**: å®Œæˆ TASK-002 Story-003 (2 SP) + Story-004 (2 SP)

**ä»»åŠ¡æ¸…å•**:
- [ ] **09:00-11:00** æ›´æ–° Prisma Schema (2h)
  - æ›´æ–° `Task` æ¨¡å‹:
    ```prisma
    model Task {
      // ...existing fields...
      
      importance          Int       @default(3)  // 1-5
      urgency             Int       @default(3)  // 1-5
      priorityScore       Int       @default(9)  // importance Ã— urgency
      autoAdjustEnabled   Boolean   @default(true)
      orderIndex          Int       @default(0)
      
      @@index([priorityScore(sort: Desc), dueDate(sort: Asc)])
      @@map("tasks")
    }
    ```
  - è¿è¡Œè¿ç§»

- [ ] **11:00-13:00** åˆ›å»º API Endpoints (2h)
  - åˆ›å»º `TaskPriorityController.ts`:
    ```typescript
    @Controller('/api/tasks')
    export class TaskPriorityController {
      constructor(private priorityService: TaskPriorityService) {}
      
      @Put('/:taskId/priority')
      @UseGuards(AuthGuard)
      async setPriority(
        @Param('taskId') taskId: string,
        @Body() body: { importance: number; urgency: number }
      ): Promise<TaskServerDTO> {
        const task = await this.taskRepository.findByUuid(taskId);
        task.setPriority(body.importance, body.urgency);
        await this.taskRepository.save(task);
        return this.toDTO(task);
      }
      
      @Post('/smart-sort')
      @UseGuards(AuthGuard)
      async smartSort(@Body() body: { taskUuids: string[] }): Promise<TaskServerDTO[]> {
        const sorted = await this.priorityService.smartSort(body.taskUuids);
        return sorted.map(t => this.toDTO(t));
      }
      
      @Get('/by-quadrant/:quadrant')
      @UseGuards(AuthGuard)
      async getByQuadrant(@Param('quadrant') quadrant: string): Promise<TaskServerDTO[]> {
        const tasks = await this.priorityService.getTasksByQuadrant(quadrant as any);
        return tasks.map(t => this.toDTO(t));
      }
    }
    ```

- [ ] **14:00-17:00** ç¼–å†™ API æµ‹è¯• + Code Review (3h)
  - PR: `feat(task): add priority matrix API`

**äº¤ä»˜ç‰©**:
- âœ… Prisma Schema æ›´æ–°
- âœ… Priority API ç«¯ç‚¹
- âœ… API æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%

---

#### **Day 8 (2025-12-10 å‘¨ä¸‰): Client Services + UI - å››è±¡é™çŸ©é˜µ**

**ç›®æ ‡**: å®Œæˆ TASK-002 Story-005 (2 SP) + Story-006 (3 SP éƒ¨åˆ†)

**ä»»åŠ¡æ¸…å•**:
- [ ] **09:00-11:00** Client Service (2h)
  - åˆ›å»º `TaskPriorityClientService.ts`
  - åˆ›å»º React Query hooks

- [ ] **11:00-17:00** åˆ›å»ºå››è±¡é™çŸ©é˜µ UI (6h)
  - åˆ›å»º `PriorityMatrixView.vue`:
    ```vue
    <template>
      <div class="priority-matrix">
        <div class="matrix-grid">
          <div class="quadrant q1">
            <div class="quadrant-header">
              <h3>Q1: é‡è¦ä¸”ç´§æ€¥</h3>
              <el-tag type="danger">{{ q1Tasks.length }} ä¸ªä»»åŠ¡</el-tag>
            </div>
            <draggable
              v-model="q1Tasks"
              :group="{ name: 'tasks', pull: true, put: true }"
              @change="onTaskMoved"
            >
              <TaskCard
                v-for="task in q1Tasks"
                :key="task.uuid"
                :task="task"
              />
            </draggable>
          </div>
          
          <div class="quadrant q2">
            <div class="quadrant-header">
              <h3>Q2: é‡è¦ä¸ç´§æ€¥</h3>
              <el-tag type="warning">{{ q2Tasks.length }} ä¸ªä»»åŠ¡</el-tag>
            </div>
            <draggable
              v-model="q2Tasks"
              :group="{ name: 'tasks', pull: true, put: true }"
              @change="onTaskMoved"
            >
              <TaskCard
                v-for="task in q2Tasks"
                :key="task.uuid"
                :task="task"
              />
            </draggable>
          </div>
          
          <div class="quadrant q3">
            <div class="quadrant-header">
              <h3>Q3: ç´§æ€¥ä¸é‡è¦</h3>
              <el-tag type="info">{{ q3Tasks.length }} ä¸ªä»»åŠ¡</el-tag>
            </div>
            <draggable
              v-model="q3Tasks"
              :group="{ name: 'tasks', pull: true, put: true }"
              @change="onTaskMoved"
            >
              <TaskCard
                v-for="task in q3Tasks"
                :key="task.uuid"
                :task="task"
              />
            </draggable>
          </div>
          
          <div class="quadrant q4">
            <div class="quadrant-header">
              <h3>Q4: ä¸é‡è¦ä¸ç´§æ€¥</h3>
              <el-tag>{{ q4Tasks.length }} ä¸ªä»»åŠ¡</el-tag>
            </div>
            <draggable
              v-model="q4Tasks"
              :group="{ name: 'tasks', pull: true, put: true }"
              @change="onTaskMoved"
            >
              <TaskCard
                v-for="task in q4Tasks"
                :key="task.uuid"
                :task="task"
              />
            </draggable>
          </div>
        </div>
        
        <div class="matrix-actions">
          <el-button type="primary" @click="smartSort">
            <el-icon><Sort /></el-icon>
            æ™ºèƒ½æ’åº
          </el-button>
        </div>
      </div>
    </template>
    
    <script setup lang="ts">
    import { ref, computed } from 'vue';
    import draggable from 'vuedraggable';
    import { useTasks } from '@/hooks/useTasks';
    import { useSmartSort } from '@/hooks/useTaskPriority';
    
    const { data: tasks } = useTasks();
    const { mutate: smartSort } = useSmartSort();
    
    const q1Tasks = computed(() => 
      tasks.value?.filter(t => t.importance >= 4 && t.urgency >= 4) || []
    );
    const q2Tasks = computed(() => 
      tasks.value?.filter(t => t.importance >= 4 && t.urgency < 4) || []
    );
    const q3Tasks = computed(() => 
      tasks.value?.filter(t => t.importance < 4 && t.urgency >= 4) || []
    );
    const q4Tasks = computed(() => 
      tasks.value?.filter(t => t.importance < 4 && t.urgency < 4) || []
    );
    
    function onTaskMoved(event: any) {
      // æ ¹æ®æ‹–æ‹½ä½ç½®è‡ªåŠ¨è°ƒæ•´é‡è¦æ€§å’Œç´§æ€¥åº¦
    }
    </script>
    
    <style scoped>
    .priority-matrix {
      height: 100%;
    }
    
    .matrix-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      grid-template-rows: 1fr 1fr;
      gap: 16px;
      height: calc(100% - 60px);
    }
    
    .quadrant {
      border: 2px solid var(--el-border-color);
      border-radius: 8px;
      padding: 16px;
      overflow-y: auto;
    }
    
    .q1 { border-color: var(--el-color-danger); background: #fef0f0; }
    .q2 { border-color: var(--el-color-warning); background: #fdf6ec; }
    .q3 { border-color: var(--el-color-info); background: #f4f4f5; }
    .q4 { border-color: var(--el-border-color); background: #fafafa; }
    </style>
    ```

- [ ] **17:00-17:30** Code Review & æäº¤
  - PR: `feat(task): add priority matrix UI`

**äº¤ä»˜ç‰©**:
- âœ… Client Service å’Œ hooks
- âœ… å››è±¡é™çŸ©é˜µ UIï¼ˆåŸºç¡€ç‰ˆï¼‰
- âœ… æ‹–æ‹½åŠŸèƒ½é›†æˆ

---

#### **Day 9 (2025-12-11 å‘¨å››): UI å®Œå–„ + E2E æµ‹è¯•å‡†å¤‡**

**ç›®æ ‡**: å®Œæˆ TASK-002 Story-006 (å‰©ä½™) + E2E å‡†å¤‡

**ä»»åŠ¡æ¸…å•**:
- [ ] **09:00-12:00** UI ä¼˜åŒ– (3h)
  - ä¼˜åŒ–æ‹–æ‹½ä½“éªŒ
  - æ·»åŠ ä»»åŠ¡å¡ç‰‡æ ·å¼
  - æ·»åŠ ä¼˜å…ˆçº§ç¼–è¾‘å¯¹è¯æ¡†

- [ ] **13:00-15:00** E2E æµ‹è¯•å‡†å¤‡ (2h)
  - ä¸ºæ‰€æœ‰ç»„ä»¶æ·»åŠ  `data-testid`
  - Review å‰ç«¯ç»„ä»¶å®Œæ•´æ€§

- [ ] **15:00-17:00** ç¼–å†™ç»„ä»¶æµ‹è¯• (2h)
  - æµ‹è¯•å››è±¡é™çŸ©é˜µ
  - æµ‹è¯•æ‹–æ‹½åŠŸèƒ½

- [ ] **17:00-17:30** Code Review
  - PR: `feat(task): complete priority matrix UI`

**äº¤ä»˜ç‰©**:
- âœ… ä¼˜å…ˆçº§çŸ©é˜µ UI å®Œæ•´ç‰ˆ
- âœ… ç»„ä»¶æµ‹è¯•è¦†ç›–ç‡ â‰¥ 80%
- âœ… E2E æµ‹è¯•å‡†å¤‡å°±ç»ª

---

#### **Day 10 (2025-12-12 å‘¨äº”): E2E Tests + Sprint Review**

**ç›®æ ‡**: å®Œæˆ GOAL-004 Story-007 (2 SP) + TASK-002 Story-007 (1 SP) + Sprint Review

**ä»»åŠ¡æ¸…å•**:
- [ ] **09:00-12:00** ç¼–å†™ E2E æµ‹è¯• (3h)
  - æµ‹è¯•ç›®æ ‡è¿›åº¦è‡ªåŠ¨è®¡ç®—æµç¨‹
  - æµ‹è¯•ä»»åŠ¡ä¼˜å…ˆçº§çŸ©é˜µæ“ä½œ
  - æµ‹è¯•æ™ºèƒ½æ’åºåŠŸèƒ½

- [ ] **13:00-15:00** Bug Fixes & ä¼˜åŒ– (2h)
  - ä¿®å¤ E2E æµ‹è¯•å‘ç°çš„é—®é¢˜
  - æ€§èƒ½ä¼˜åŒ–
  - æœ€ç»ˆä»£ç æ¸…ç†

- [ ] **15:00-17:00** Sprint Review ä¼šè®® (2h)
  - **å‚ä¸è€…**: å…¨å‘˜ + äº§å“ç»ç†
  - **è®®ç¨‹**:
    - Demo ç›®æ ‡è¿›åº¦è‡ªåŠ¨è®¡ç®—ï¼ˆ10 åˆ†é’Ÿï¼‰
    - Demo ä»»åŠ¡ä¼˜å…ˆçº§çŸ©é˜µï¼ˆ10 åˆ†é’Ÿï¼‰
    - Review Story å®Œæˆæƒ…å†µï¼ˆ30 åˆ†é’Ÿï¼‰
      - GOAL-004: 15/15 SP âœ…
      - TASK-002: 15/15 SP âœ…
      - æ€»è®¡: 30/30 SP (100%)
    - è®¨è®ºæŠ€æœ¯å€ºåŠ¡ï¼ˆ15 åˆ†é’Ÿï¼‰
    - æ”¶é›†åé¦ˆå’Œæ”¹è¿›å»ºè®®ï¼ˆ15 åˆ†é’Ÿï¼‰
    - ç¡®è®¤ Sprint 3 æ˜¯å¦è¾¾åˆ° DoDï¼ˆ10 åˆ†é’Ÿï¼‰

- [ ] **17:00-17:30** Sprint Retrospective ä¼šè®® (30 åˆ†é’Ÿ)
  - å›é¡¾ Sprint 3 è¡¨ç°
  - è®¨è®ºæ”¹è¿›æªæ–½
  - ä¸º Sprint 4 åšå‡†å¤‡

**äº¤ä»˜ç‰©**:
- âœ… E2E æµ‹è¯•å¥—ä»¶å®Œæ•´
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… Sprint Review å®Œæˆ
- âœ… Sprint Retrospective å®Œæˆ

---

## ğŸ“Š Sprint ç»Ÿè®¡

### Story å®Œæˆæƒ…å†µ

#### GOAL-004 (15 SP)

| Story ID | æ ‡é¢˜ | SP | é¢„ä¼°å·¥æ—¶ | çŠ¶æ€ |
|----------|------|----|---------|----|
| GOAL-004-S001 | Contracts & Domain | 3 | 1d | Planning |
| GOAL-004-S002 | Application Service | 3 | 1d | Planning |
| GOAL-004-S003 | Infrastructure | 2 | 0.5d | Planning |
| GOAL-004-S004 | API Endpoints | 2 | 0.5d | Planning |
| GOAL-004-S005 | Client Services | 2 | 0.5d | Planning |
| GOAL-004-S006 | UI - è¿›åº¦åˆ†è§£ | 3 | 1d | Planning |
| GOAL-004-S007 | E2E Tests | 2 | 0.5d | Planning |

**å°è®¡**: 15 SP, é¢„ä¼° 5 å·¥ä½œæ—¥

#### TASK-002 (15 SP)

| Story ID | æ ‡é¢˜ | SP | é¢„ä¼°å·¥æ—¶ | çŠ¶æ€ |
|----------|------|----|---------|----|
| TASK-002-S001 | Contracts & Domain | 2 | 0.5d | Planning |
| TASK-002-S002 | Application Service | 3 | 1d | Planning |
| TASK-002-S003 | Infrastructure | 2 | 0.5d | Planning |
| TASK-002-S004 | API Endpoints | 2 | 0.5d | Planning |
| TASK-002-S005 | Client Services | 2 | 0.5d | Planning |
| TASK-002-S006 | UI - å››è±¡é™çŸ©é˜µ | 3 | 1.5d | Planning |
| TASK-002-S007 | E2E Tests | 1 | 0.5d | Planning |

**å°è®¡**: 15 SP, é¢„ä¼° 5 å·¥ä½œæ—¥

**æ€»è®¡**: 30 SP, é¢„ä¼° 10 å·¥ä½œæ—¥ï¼ˆ2 å‘¨ï¼‰

---

## âœ… Definition of Done (DoD)

### Story çº§åˆ« DoD

æ¯ä¸ª Story å¿…é¡»æ»¡è¶³:
- [ ] æ‰€æœ‰éªŒæ”¶æ ‡å‡†é€šè¿‡
- [ ] ä»£ç è¦†ç›–ç‡ â‰¥ 80%
- [ ] ESLint æ£€æŸ¥é€šè¿‡
- [ ] TypeScript ç¼–è¯‘æ— é”™è¯¯
- [ ] Code Review å®Œæˆå¹¶æ‰¹å‡†
- [ ] API æ–‡æ¡£æ›´æ–°ï¼ˆå¦‚é€‚ç”¨ï¼‰
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾æ ‡

### Sprint çº§åˆ« DoD

Sprint 3 å¿…é¡»æ»¡è¶³:
- [ ] æ‰€æœ‰ 14 ä¸ª Stories çŠ¶æ€ä¸º Done
- [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆå•å…ƒ + é›†æˆ + E2Eï¼‰
- [ ] æ—  P0 Bug
- [ ] P1 Bug â‰¤ 3 ä¸ª
- [ ] ä»£ç è¦†ç›–ç‡ â‰¥ 80%
- [ ] å¯éƒ¨ç½²åˆ° Staging ç¯å¢ƒ
- [ ] Sprint Review å®Œæˆ
- [ ] Sprint Retrospective å®Œæˆ

---

## ğŸš¨ é£é™©ç®¡ç†

| é£é™© | æ¦‚ç‡ | å½±å“ | ç¼“è§£ç­–ç•¥ | è´Ÿè´£äºº |
|------|------|------|---------|--------|
| è¿›åº¦è®¡ç®—é€»è¾‘å¤æ‚ | ä¸­ | é«˜ | å……åˆ†çš„å•å…ƒæµ‹è¯•ï¼Œè¦†ç›–è¾¹ç•Œæƒ…å†µ | åç«¯è´Ÿè´£äºº |
| æƒé‡å˜åŒ–è§¦å‘é¢‘ç¹é‡ç®— | ä½ | ä¸­ | äº‹ä»¶å»é‡ï¼Œæ‰¹é‡å¤„ç† | åç«¯è´Ÿè´£äºº |
| å››è±¡é™çŸ©é˜µæ‹–æ‹½æ€§èƒ½ | ä½ | ä¸­ | ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨ï¼Œé™åˆ¶ä»»åŠ¡æ•°é‡ | å‰ç«¯è´Ÿè´£äºº |
| ä¾èµ– Sprint 2a/2b | ä¸­ | é«˜ | ç¡®ä¿ Sprint 2a/2b æŒ‰æ—¶å®Œæˆ | PM |

---

## ğŸ“ˆ Sprint ç›‘æ§æŒ‡æ ‡

åŒ Sprint 2aï¼Œè¯¦è§ [sprint-02a-plan.md](./sprint-02a-plan.md)

---

## ğŸ”§ æŠ€æœ¯æ ˆæ€»ç»“

åŒ Sprint 2a/2bï¼Œé¢å¤–å¢åŠ :
- **æ‹–æ‹½åº“**: vuedraggable 4.x

---

## ğŸ“š å‚è€ƒæ–‡æ¡£

- [Epic: GOAL-004 - ç›®æ ‡è¿›åº¦è‡ªåŠ¨è®¡ç®—](../epics/epic-goal-004-progress-auto-calculation.md)
- [Epic: TASK-002 - ä»»åŠ¡ä¼˜å…ˆçº§çŸ©é˜µ](../epics/epic-task-002-priority-matrix.md)
- [PM é˜¶æ®µæ€»ç»“](../PM_PHASE_SUMMARY.md)
- [Sprint 2a è®¡åˆ’](./sprint-02a-plan.md)
- [Sprint 2b è®¡åˆ’](./sprint-02b-plan.md)

---

## ğŸ¯ Sprint æˆåŠŸæ ‡å‡†

Sprint 3 è¢«è®¤ä¸ºæˆåŠŸå½“ä¸”ä»…å½“:
1. âœ… æ‰€æœ‰ 14 ä¸ª Stories å®Œæˆå¹¶é€šè¿‡éªŒæ”¶
2. âœ… æ‰€æœ‰ DoD æ£€æŸ¥é¡¹é€šè¿‡
3. âœ… å¯åœ¨ Staging ç¯å¢ƒæ­£å¸¸è¿è¡Œ
4. âœ… äº§å“ç»ç†éªŒæ”¶é€šè¿‡
5. âœ… è¿›åº¦è®¡ç®—å‡†ç¡®ï¼Œå››è±¡é™çŸ©é˜µæ˜“ç”¨
6. âœ… å›¢é˜Ÿå‡†å¤‡å¥½å¼€å§‹ Sprint 4

---

**Sprint è®¡åˆ’åˆ›å»ºäº**: 2025-10-21  
**è®¡åˆ’å®¡æ‰¹**: å¾…å›¢é˜Ÿ Review  
**å‰ç½®æ¡ä»¶**: Sprint 2a/2b å®Œæˆ  
**ä¸‹ä¸€æ­¥**: ç­‰å¾… Sprint 2b å®Œæˆåå¯åŠ¨

---

*ç¥ Sprint 3 é¡ºåˆ©ï¼ğŸš€*
